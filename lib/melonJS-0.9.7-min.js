var me=me||{};(function(a){function g(){if(!e){if(!b.body)return setTimeout(g,13);b.removeEventListener?b.removeEventListener("DOMContentLoaded",g,!1):a.removeEventListener("load",g,!1),e=!0;for(var c=0;c<f.length;c++)f[c].call(a,[]);f.length=0}}function h(){if(d)return;d=!0;if(b.readyState==="complete")return g();b.addEventListener&&b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)}function l(){if(c)return;me.utils.setNocache(b.location.href.match(/\?nocache/)||!1),me.audio.detectCapabilities(),me.sys.touch="createTouch"in b||"ontouchstart"in a||navigator.isCocoonJS,me.sys.isMobile=me.sys.ua.match(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i),me.timer.init(),me.mapReader=new me.TMXMapReader,me.loadingScreen=new me.DefaultLoadingScreen,me.state.init(),me.entityPool.init(),me.levelDirector.reset(),c=!0}var b=a.document;me={mod:"melonJS",version:"@VERSION",nocache:"",audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,TMXParser:null,loadingScreen:null,TMXTileMap:null},me.sys={ua:navigator.userAgent,sound:!1,localStorage:typeof a.localStorage=="object",gyro:a.DeviceMotionEvent!==undefined,nativeBase64:typeof a.atob=="function",touch:!1,isMobile:!1,fps:60,interpolation:!1,scale:null,gravity:undefined,useNativeAnimFrame:!1,cacheImage:!1,dirtyRegion:!1,stopOnAudioError:!0,pauseOnBlur:!0,preRender:!1,checkVersion:function(a,b){b=b||me.version;var c=a.split("."),d=b.split("."),e=Math.min(c.length,d.length),f=0;for(var g=0;g<e;g++)if(f=+c[g]- +d[g])break;return f?f:c.length-d.length}};var c=!1,d=!1,e=!1,f=[];a.onReady=function(b){return h(),e?b.call(a,[]):f.push(function(){return b.call(a,[])}),this},a.onReady(function(){l()});var i=!1,j=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;Object.extend=function(a){function e(){!i&&this.init&&this.init.apply(this,arguments)}var b=this.prototype;i=!0;var c=new this;i=!1;for(var d in a)c[d]=typeof a[d]=="function"&&typeof b[d]=="function"&&j.test(a[d])?function(a,c){return function(){var d=this.parent;this.parent=b[a];var e=c.apply(this,arguments);return this.parent=d,e}}(d,a[d]):a[d];return e.prototype=c,e.constructor=e,e.extend=Object.extend,e},typeof Object.create!="function"&&(Object.create=function(a){function b(){}return b.prototype=a,new b});if(!Function.prototype.bind){function k(){}Function.prototype.bind=function(a){var b=this;if(typeof b!="function")throw new TypeError("Function.prototype.bind called on incompatible "+b);var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=b.apply(this,c.concat(Array.prototype.slice.call(arguments)));return Object(e)===e?e:this}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return b.prototype&&(k.prototype=b.prototype,d.prototype=new k,k.prototype=null),d}}typeof Date.now=="undefined"&&(Date.now=function(){return(new Date).getTime()}),typeof console=="undefined"&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}}),Function.prototype.defer=function(){var a=this,b=Array.prototype.slice.call(arguments);return window.setTimeout(function(){return a.apply(a,b)},.01)},Object.defineProperty||(Object.defineProperty=function(a,b,c){if(a.__defineGetter__)c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set);else throw"melonJS: Object.defineProperty not supported"}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),String.prototype.isNumeric=function(){return this!=null&&!isNaN(this)&&this.trim()!=""},String.prototype.isBoolean=function(){return this!=null&&("true"==this.trim()||"false"==this.trim())},String.prototype.contains=function(a){return this.indexOf(a)>-1},String.prototype.toHex=function(){var a="",b=0;while(b<this.length)a+=this.charCodeAt(b++).toString(16);return a},Number.prototype.clamp=function(a,b){return this<a?a:this>b?b:+this},Number.prototype.random=function(a,b){return~~(Math.random()*(b-a+1))+a},Number.prototype.round=function(){var a=arguments.length<2?this:arguments[0],b=Math.pow(10,arguments[1]||arguments[0]||0);return Math.round(a*b)/b},Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt(this-this%16>>4)+"0123456789ABCDEF".charAt(this%16)},Number.prototype.sign=function(){return this<0?-1:this>0?1:0},Number.prototype.degToRad=function(a){return(a||this)/180*Math.PI},Number.prototype.radToDeg=function(a){return(a||this)*(180/Math.PI)},Array.prototype.remove=function(a){var b=Array.prototype.indexOf.call(this,a);return b!==-1&&Array.prototype.splice.call(this,b,1),this},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d--;c++)a.call(b||this,this[c],c,this)}),Object.defineProperty(me,"initialized",{get:function(){return c}});var m=function(){var a={},b=[],c,d=[],e=0;return a.isDirty=!1,a.reset=function(){b.length=0,d.length=0,c=me.game.viewport.getRect(),a.makeAllDirty()},a.makeDirty=function(c,e,f){e&&(a.isDirty=!0,me.sys.dirtyRegion&&(f?b.push(f.union(c)):c.getRect&&b.push(c.getRect()))),c.inViewport&&d.unshift(c)},a.makeAllDirty=function(){b.length=0,b.push(c),a.isDirty=!0},a.remove=function(b){var c=d.indexOf(b);c!=-1&&(d.splice(c,1),b.inViewport=!1,a.makeDirty(b,!0))},a.getDrawCount=function(){return e},a.draw=function(a){var c=me.game.viewport.pos.x+~~me.game.viewport.offset.x,f=me.game.viewport.pos.y+~~me.game.viewport.offset.y;a.save(),a.translate(-c,-f),c-=me.game.currentLevel.pos.x,f-=me.game.currentLevel.pos.y;for(var g=b.length,h;g--,h=b[g];){for(var i=d.length,j;i--,j=d[i];){if(me.sys.dirtyRegion&&j.isSprite&&!j.overlaps(h))continue;j.floating===!0&&(a.save(),a.translate(c,f)),j.draw(a,h),j.floating===!0&&a.restore(),e++}me.debug.renderDirty&&h.draw(a,"white")}a.restore()},a.flush=function(){me.sys.dirtyRegion&&(b.length=0),d.length=0,a.isDirty=!1,e=0},a}();me.game=function(){var a={},b=null,c=[],d=!1,e=null,f=null,g=function(a,b){return b.z-a.z};return a.viewport=null,a.HUD=null,a.collisionMap=null,a.currentLevel=null,a.renderer=null,a.NO_OBJECT=0,a.ENEMY_OBJECT=1,a.COLLECTABLE_OBJECT=2,a.ACTION_OBJECT=3,a.onLevelLoaded=null,a.init=function(c,e){if(!d){var c=c||me.video.getWidth(),e=e||me.video.getHeight();a.viewport=new me.Viewport(0,0,c,e),b=me.video.getSystemContext(),me.event.publish(me.event.GAME_INIT),d=!0}},a.reset=function(){d||a.init(),a.removeAll(!0),a.viewport&&a.viewport.reset(),m.reset(),b.setTransform(1,0,0,1,0,0),a.currentLevel={pos:{x:0,y:0}}},a.loadTMXLevel=function(c){a.currentLevel=c,a.collisionMap=a.currentLevel.getLayerByName("collision"),(!a.collisionMap||!a.collisionMap.isCollisionMap)&&console.error("WARNING : no collision map detected");var d=a.currentLevel.getLayers();for(var e=d.length;e--;)d[e].visible&&a.add(d[e]);a.viewport.setBounds(Math.max(a.currentLevel.width,a.viewport.width),Math.max(a.currentLevel.height,a.viewport.height));var f=a.currentLevel.getObjectGroups();for(var g=0;g<f.length;g++)if(f[g].visible)for(var h=0;h<f[g].objects.length;h++)a.addEntity(f[g].objects[h],f[g].z);a.currentLevel.pos.x!=a.currentLevel.pos.y&&b.translate(a.currentLevel.pos.x,a.currentLevel.pos.y),a.sort(),a.onLevelLoaded&&a.onLevelLoaded.call(a.onLevelLoaded,c.name),me.event.publish(me.event.LEVEL_LOADED,[c.name])},a.add=function(a,b){a.z=b?b:a.z,c.push(a)},a.addEntity=function(b,c){var d=me.entityPool.newInstanceOf(b.name,b.x,b.y,b);d&&a.add(d,c)},a.getEntityByName=function(a){var b=[];a=a.toLowerCase();for(var d=c.length,e;d--,e=c[d];)e.name&&e.name.toLowerCase()===a&&b.push(e);return b},a.getObjectCount=function(){return c.length},a.getDrawCount=function(){return m.getDrawCount()},a.getEntityByGUID=function(a){for(var b=c.length,d;b--,d=c[b];)if(d.isEntity&&d.GUID==a)return d;return null},a.getEntityByProp=function(a,b){var d=[];for(var e=c.length,f;e--,f=c[e];)f.isEntity&&f[a]==b&&d.push(f);return d},a.addHUD=function(b,c,d,e,f){a.HUD==null&&(a.HUD=new me.HUD_Object(b,c,d,e,f),a.add(a.HUD))},a.disableHUD=function(){a.HUD!=null&&(a.remove(a.HUD),a.HUD=null)},a.update=function(){var b=null;for(var d=c.length,e;d--,e=c[d];){b=me.sys.dirtyRegion&&e.isSprite?e.getRect():null,e.inViewport=e.visible&&(e.floating||e.getRect&&a.viewport.isVisible(e));var f=e.update();m.makeDirty(e,f,f?b:null)}a.viewport.update(m.isDirty)&&m.makeAllDirty()},a.remove=function(a,b){function d(a){a.destroy&&a.destroy(),m.remove(a),c.remove(a),me.entityPool.freeInstance(a)}b===!0?d(a):(a.visible=!1,e=function(a){d(a),e=null}.defer(a))},a.removeAll=function(b){e&&(clearTimeout(e),e=null),f&&(clearTimeout(f),f=null);for(var d=c.length;d--;){if(c[d].isPersistent)continue;a.remove(c[d],b)}b===!0&&m.flush()},a.sort=function(a){f===null&&(typeof a!="function"&&(a=g),f=function(a){c.sort(a),f=null,me.game.repaint()}.defer(a))},a.collide=function(a,b){var d;b=b===!0?!0:!1;if(b===!0)var e=[],f=0;for(var g=c.length,h;g--,h=c[g];)if(h.inViewport&&h.visible&&h.collidable&&h!=a){d=h.collisionBox.collideVsAABB.call(h.collisionBox,a.collisionBox);if(d.x!=0||d.y!=0){h.onCollision.call(h,d,a),d.type=h.type,d.obj=h;if(!b)return d;e[f++]=d}}return b?e:null},a.collideType=function(a,b,d){var e;d=d===!0?!0:!1;if(d===!0)var f=[],g=0;for(var h=c.length,i;h--,i=c[h];)if(i.inViewport&&i.visible&&i.collidable&&i.type===b&&i!=a){e=i.collisionBox.collideVsAABB.call(i.collisionBox,a.collisionBox);if(e.x!=0||e.y!=0){i.onCollision.call(i,e,a),e.type=i.type,e.obj=i;if(!d)return e;f[g++]=e}}return d?f:null},a.repaint=function(){m.makeAllDirty()},a.draw=function(){m.isDirty&&(m.draw(b),a.viewport.draw(b)),m.flush()},a}()})(window),function(a){me.Vector2d=Object.extend({x:0,y:0,init:function(a,b){this.x=a||0,this.y=b||0},set:function(a,b){this.x=a,this.y=b},setZero:function(){this.set(0,0)},setV:function(a){this.x=a.x,this.y=a.y},add:function(a){this.x+=a.x,this.y+=a.y},sub:function(a){this.x-=a.x,this.y-=a.y},scale:function(a){this.x*=a.x,this.y*=a.y},div:function(a){this.x/=a,this.y/=a},abs:function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},clamp:function(a,b){return new me.Vector2d(this.x.clamp(a,b),this.y.clamp(a,b))},clampSelf:function(a,b){return this.x=this.x.clamp(a,b),this.y=this.y.clamp(a,b),this},minV:function(a){this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y},maxV:function(a){this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y},floor:function(){return new me.Vector2d(~~this.x,~~this.y)},floorSelf:function(){return this.x=~~this.x,this.y=~~this.y,this},ceil:function(){return new me.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},negate:function(){return new me.Vector2d(-this.x,-this.y)},negateSelf:function(){return this.x=-this.x,this.y=-this.y,this},copy:function(a){this.x=a.x,this.y=a.y},equals:function(a){return this.x===a.x&&this.y===a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.length();if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},dotProduct:function(a){return this.x*a.x+this.y*a.y},distance:function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},angle:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},clone:function(){return new me.Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+"y:"+this.y}}),me.Rect=Object.extend({pos:null,colPos:null,anchorPoint:null,width:0,height:0,hWidth:0,hHeight:0,init:function(a,b,c){this.pos=a,this.colPos=new me.Vector2d,this.width=b,this.height=c,this.hWidth=~~(b/2),this.hHeight=~~(c/2),this.anchorPoint=new me.Vector2d(.5,.5),Object.defineProperty(this,"left",{get:function(){return this.pos.x},configurable:!0}),Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.width},configurable:!0}),Object.defineProperty(this,"top",{get:function(){return this.pos.y},configurable:!0}),Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.height},configurable:!0})},set:function(a,b,c){this.pos=a,this.width=b,this.height=c,this.hWidth=~~(b/2),this.hHeight=~~(c/2)},getRect:function(){return new me.Rect(this.pos.clone(),this.width,this.height)},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this},translateV:function(a){return this.pos.add(a),this},union:function(a){var b=Math.min(this.pos.x,a.pos.x),c=Math.min(this.pos.y,a.pos.y);return this.width=Math.ceil(Math.max(this.pos.x+this.width,a.pos.x+a.width)-b),this.height=Math.ceil(Math.max(this.pos.y+this.height,a.pos.y+a.height)-c),this.pos.x=~~b,this.pos.y=~~c,this},adjustSize:function(a,b,c,d){a!=-1&&(this.colPos.x=a,this.width=b,this.hWidth=~~(this.width/2),this.left!==this.pos.x+this.colPos.x&&Object.defineProperty(this,"left",{get:function(){return this.pos.x+this.colPos.x},configurable:!0}),this.right!==this.pos.x+this.colPos.x+this.width&&Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.colPos.x+this.width},configurable:!0})),c!=-1&&(this.colPos.y=c,this.height=d,this.hHeight=~~(this.height/2),this.top!==this.pos.y+this.colPos.y&&Object.defineProperty(this,"top",{get:function(){return this.pos.y+this.colPos.y},configurable:!0}),this.bottom!==this.pos.y+this.colPos.y+this.height&&Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.colPos.y+this.height},configurable:!0}))},flipX:function(a){this.colPos.x=a-this.width-this.colPos.x,this.hWidth=~~(this.width/2)},flipY:function(a){this.colPos.y=a-this.height-this.colPos.y,this.hHeight=~~(this.height/2)},equals:function(a){return this.left===a.left&&this.right===a.right&&this.top===a.top&&this.bottom===a.bottom},overlaps:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},within:function(a){return a.left<=this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},contains:function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPoint:function(a){return a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom},collideVsAABB:function(a){var b=new me.Vector2d(0,0);if(this.overlaps(a)){var c=this.left+this.hWidth-a.left-a.hWidth,d=this.top+this.hHeight-a.top-a.hHeight;b.x=a.hWidth+this.hWidth-(c<0?-c:c),b.y=a.hHeight+this.hHeight-(d<0?-d:d),b.x<b.y?(b.y=0,b.x=c<0?-b.x:b.x):(b.x=0,b.y=d<0?-b.y:b.y)}return b},draw:function(a,b){a.strokeStyle=b||"red",a.strokeRect(this.left,this.top,this.width,this.height)}})}(window),function(a){me.debug={displayFPS:!1,renderHitBox:!1,renderCollisionMap:!1,renderDirty:!1,renderVelocity:!1}}(window),function(a){me.Renderable=me.Rect.extend({isRenderable:!0,visible:!0,inViewport:!1,isPersistent:!1,floating:!1,init:function(a,b,c){this.parent(a,b,c)},update:function(){return!1},draw:function(a,b){this.parent(a,b)}})}(window),function(a){var b=Math.PI*2;me.SpriteObject=me.Renderable.extend({scale:null,scaleFlag:!1,lastflipX:!1,lastflipY:!1,z:0,offset:null,angle:0,alpha:1,image:null,flickering:!1,flickerTimer:-1,flickercb:null,flickerState:!1,init:function(a,b,c,d,e){this.isSprite=!0,this.parent(new me.Vector2d(a,b),d||c.width,e||c.height),this.image=c,this.scale=new me.Vector2d(1,1),this.lastflipX=this.lastflipY=!1,this.scaleFlag=!1,this.offset=new me.Vector2d(0,0),this.alpha=1,this.visible=!0,this.isPersistent=!1,this.flickering=!1},setTransparency:function(a){a=a.charAt(0)=="#"?a.substring(1,7):a,this.image=me.video.applyRGBFilter(this.image,"transparent",a.toUpperCase()).canvas},isFlickering:function(){return this.flickering},flicker:function(a,b){this.flickerTimer=a,this.flickerTimer<0?(this.flickering=!1,this.flickercb=null):this.flickering||(this.flickercb=b,this.flickering=!0)},flipX:function(a){a!=this.lastflipX&&(this.lastflipX=a,this.scale.x=-this.scale.x,this.scaleFlag=this.scale.x!=1||this.scale.y!=1)},flipY:function(a){a!=this.lastflipY&&(this.lastflipY=a,this.scale.y=-this.scale.y,this.scaleFlag=this.scale.x!=1||this.scale.y!=1)},resize:function(a){a>0&&(this.scale.x=this.scale.x<0?-a:a,this.scale.y=this.scale.y<0?-a:a,this.scaleFlag=this.scale.x!=1||this.scale.y!=1)},getOpacity:function(){return this.alpha},setOpacity:function(a){a&&(this.alpha=a.clamp(0,1))},update:function(){return this.flickering?(this.flickerTimer-=me.timer.tick,this.flickerTimer<0&&(this.flickercb&&this.flickercb(),this.flicker(-1)),!0):!1},draw:function(a){if(this.flickering){this.flickerState=!this.flickerState;if(!this.flickerState)return}a.save(),a.globalAlpha=this.alpha;var b=~~this.pos.x,c=~~this.pos.y;if(this.scaleFlag||this.angle!==0){var d=this.width*this.anchorPoint.x,e=this.height*this.anchorPoint.y;a.translate(b+d,c+e),this.scaleFlag&&a.scale(this.scale.x,this.scale.y),this.angle!==0&&a.rotate(this.angle),b=-d,c=-e}a.drawImage(this.image,this.offset.x,this.offset.y,this.width,this.height,b,c,this.width,this.height),a.restore(),me.debug.renderHitBox&&this.parent(a,"green")},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}}),me.AnimationSheet=me.SpriteObject.extend({fpscount:0,spacing:0,margin:0,animationpause:!1,animationspeed:0,init:function(a,b,c,d,e,f,g,h){this.anim=[],this.resetAnim=null,this.current=null,this.animationspeed=me.sys.fps/10,this.spritecount=null,this.spacing=f||0,this.margin=g||0,this.defaultAngle=0,this.parent(a,b,c,d,e,f,g),this.textureAtlas=null,this.buildLocalAtlas(h||undefined),this.addAnimation("default",null),this.setCurrentAnimation("default")},buildLocalAtlas:function(a){if(a!==undefined)this.textureAtlas=a,this.spritecount=new me.Vector2d(this.textureAtlas.length,1);else{this.textureAtlas=[],this.spritecount=new me.Vector2d(~~((this.image.width-this.margin)/(this.width+this.spacing)),~~((this.image.height-this.margin)/(this.height+this.spacing))),this.spritecount.x*this.spritecount.y==1&&(this.setAnimationFrame=function(){});for(var b=0,c=this.spritecount.x*this.spritecount.y;b<c;b++)this.textureAtlas[b]={offset:new me.Vector2d(this.margin+(this.spacing+this.width)*(b%this.spritecount.x),this.margin+(this.spacing+this.height)*~~(b/this.spritecount.x)),width:this.width,height:this.height,angle:0}}},addAnimation:function(a,b,c){this.anim[a]={name:a,frame:[],idx:0,length:0,animationspeed:c||this.animationspeed};if(b==null){b=[];for(var d=0,e=this.spritecount.x*this.spritecount.y;d<e;d++)b[d]=d}for(var d=0,f=b.length;d<f;d++)this.anim[a].frame[d]=this.textureAtlas[b[d]];this.anim[a].length=this.anim[a].frame.length},setCurrentAnimation:function(a,b){if(this.anim[a])this.current=this.anim[a],this.resetAnim=b||null,this.setAnimationFrame(this.current.idx);else throw"melonJS: animation id '"+a+"' not defined"},isCurrentAnimation:function(a){return this.current.name==a},setAnimationFrame:function(a){this.current.idx=(a||0)%this.current.length;var c=this.current.frame[this.current.idx];this.offset=c.offset,this.width=c.width,this.height=c.height,this.defaultAngle!==c.angle&&(this.angle=(this.angle+c.angle-this.defaultAngle)%b,this.defaultAngle=c.angle)},getCurrentAnimationFrame:function(){return this.current.idx},update:function(){return this.visible&&!this.animationpause&&this.fpscount++>this.current.animationspeed?(this.setAnimationFrame(++this.current.idx),this.fpscount=0,this.current.idx==0&&this.resetAnim&&(typeof this.resetAnim=="string"?this.setCurrentAnimation(this.resetAnim):typeof this.resetAnim=="function"&&this.resetAnim()),this.parent()||!0):this.parent()}})}(window),function(a){me.TextureAtlas=Object.extend({format:null,texture:null,atlas:null,init:function(a,b){if(a&&a.meta&&a.meta.app.contains("texturepacker")){this.format="texturepacker";if(b===undefined){var c=me.utils.getBasename(a.meta.image);this.texture=me.loader.getImage(c);if(this.texture===null)throw"melonjs: Atlas texture '"+c+"' not found"}else this.texture=b;this.atlas=this.initFromTexturePacker(a)}if(this.atlas===null)throw"melonjs: texture atlas format not supported"},initFromTexturePacker:function(a){var b={};return a.frames.forEach(function(a){if(a.rotated===!0)var c=a.frame.h,d=a.frame.w;else var c=a.frame.w,d=a.frame.h;b[a.filename]={frame:new me.Rect(new me.Vector2d(a.frame.x,a.frame.y),c,d),source:new me.Rect(new me.Vector2d(a.spriteSourceSize.x,a.spriteSourceSize.y),a.spriteSourceSize.w,a.spriteSourceSize.h),rotated:a.rotated===!0,trimmed:a.trimmed===!0}}),b},createSpriteFromName:function(a){var b=this.atlas[a];if(b){var c=new me.SpriteObject(0,0,this.texture,b.frame.width,b.frame.height);return c.offset.setV(b.frame.pos),b.rotated===!0&&(c.angle=-(Math.PI/2)),c}throw"melonjs: TextureAtlas - region not found"},createAnimationFromName:function(a){var b=[],c=0;for(var d=0;d<a.length;++d){var e=this.atlas[a[d]];if(e)b[c++]={pos:e.source.pos.clone(),offset:e.frame.pos.clone(),width:e.frame.width,height:e.frame.height,angle:e.rotated===!0?-(Math.PI/2):0};else throw"melonjs: TextureAtlas - region for "+a[d]+" not found"}return new me.AnimationSheet(0,0,this.texture,0,0,0,0,b)}})}(window),function(a){var b=Math.min,c=Math.max;me.Viewport=me.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,shaking:!1,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,init:function(a,b,c,d,e,f){this.parent(new me.Vector2d(a,b),c-a,d-b),this.limits=new me.Vector2d(e||this.width,f||this.height),this.offset=new me.Vector2d,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null,start:0},this._fadeOut={color:0,alpha:0,duration:0,tween:null},this._fadeIn={color:0,alpha:1,duration:0,tween:null},this.setDeadzone(this.width/6,this.height/6)},_followH:function(a){return a.x-this.pos.x>this._deadwidth?(this.pos.x=~~b(a.x-this._deadwidth,this._limitwidth),!0):a.x-this.pos.x<this.deadzone.x?(this.pos.x=~~c(a.x-this.deadzone.x,0),!0):!1},_followV:function(a){return a.y-this.pos.y>this._deadheight?(this.pos.y=~~b(a.y-this._deadheight,this._limitheight),!0):a.y-this.pos.y<this.deadzone.y?(this.pos.y=~~c(a.y-this.deadzone.y,0),!0):!1},reset:function(a,b){this.pos.x=a||0,this.pos.y=b||0,this.target=null,this.follow_axis=null},setDeadzone:function(a,b){this.deadzone=new me.Vector2d(~~((this.width-a)/2),~~((this.height-b)/2-b*.25)),this._deadwidth=this.width-this.deadzone.x,this._deadheight=this.height-this.deadzone.y,this.update(!0)},setBounds:function(a,b){this.limits.set(a,b),this._limitwidth=this.limits.x-this.width,this._limitheight=this.limits.y-this.height},follow:function(a,b){if(a instanceof me.ObjectEntity)this.target=a.pos;else if(a instanceof me.Vector2d)this.target=a;else throw"melonJS: invalid target for viewport.follow";this.follow_axis=b||this.AXIS.BOTH,this.update(!0)},move:function(a,b){var c=~~(this.pos.x+a),d=~~(this.pos.y+b);this.pos.x=c.clamp(0,this._limitwidth),this.pos.y=d.clamp(0,this._limitheight)},update:function(a){if(this.target&&a)switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:a=this._followH(this.target);break;case this.AXIS.VERTICAL:a=this._followV(this.target);break;case this.AXIS.BOTH:a=this._followH(this.target),a=this._followV(this.target)||a;break;default:}if(this.shaking){var b=me.timer.getTime()-this._shake.start;if(b<this._shake.duration){if(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.HORIZONTAL)this.offset.x=(Math.random()-.5)*this._shake.intensity;if(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.VERTICAL)this.offset.y=(Math.random()-.5)*this._shake.intensity}else this.shaking=!1,this.offset.setZero(),typeof this._shake.onComplete=="function"&&this._shake.onComplete();a=!0}if(this._fadeIn.tween!=null||this._fadeOut.tween!=null)a=!0;return a},shake:function(a,b,c,d){this.shaking=!0,this._shake={intensity:a,duration:b,axis:c||this.AXIS.BOTH,onComplete:d||null,start:me.timer.getTime()}},fadeOut:function(a,b,c){this._fadeOut.color=a,this._fadeOut.duration=b||1e3,this._fadeOut.alpha=1,this._fadeOut.tween=(new me.Tween(this._fadeOut)).to({alpha:0},this._fadeOut.duration).onComplete(c||null),this._fadeOut.tween.start()},fadeIn:function(a,b,c){this._fadeIn.color=a,this._fadeIn.duration=b||1e3,this._fadeIn.alpha=0,this._fadeIn.tween=(new me.Tween(this._fadeIn)).to({alpha:1},this._fadeIn.duration).onComplete(c||null),this._fadeIn.tween.start()},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(a){this.pos.x=a.x-this.width*.5,this.pos.y=a.y-this.height*.5},isVisible:function(a){return a.overlaps(this)},draw:function(a){this._fadeIn.tween&&(a.globalAlpha=this._fadeIn.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeIn.color)),a.globalAlpha=1,this._fadeIn.alpha==1&&(this._fadeIn.tween=null)),this._fadeOut.tween&&(a.globalAlpha=this._fadeOut.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeOut.color)),a.globalAlpha=1,this._fadeOut.alpha==0&&(this._fadeOut.tween=null))}})}(window),function(a){me.ObjectSettings={name:null,image:null,transparent_color:null,spritewidth:null,spriteheight:null,type:0,collidable:!0},me.entityPool=function(){var a={},b={};return a.init=function(){a.add("me.ObjectEntity",me.ObjectEntity),a.add("me.CollectableEntity",me.CollectableEntity),a.add("me.LevelEntity",me.LevelEntity)},a.add=function(a,c,d){if(!d){b[a.toLowerCase()]=c;return}b[a.toLowerCase()]={"class":c,pool:[],active:[]}},a.newInstanceOf=function(a){var c=typeof a=="string"?a.toLowerCase():undefined;if(c&&b[c]){if(!b[c].pool){var d=b[c];return arguments[0]=d,new(d.bind.apply(d,arguments))}var e,f=b[c],d=f["class"];return f.pool.length>0?(e=f.pool.pop(),e.init.apply(e,Array.prototype.slice.call(arguments,1))):(arguments[0]=d,e=new(d.bind.apply(d,arguments)),e.className=c),f.active.push(e),e}var g=arguments[3];return g&&g.image?new me.SpriteObject(g.x,g.y,g.image):(c&&console.error("Cannot instantiate entity of type '"+c+"': Class not found!"),null)},a.purge=function(){for(className in b)b[className].pool=[]},a.freeInstance=function(a){var c=a.className;if(!c||!b[c])return;var d=!0;for(var e=0,f=b[c].active.length;e<f;e++)if(b[c].active[e]===a){d=!1,b[c].active.splice(e,1);break}if(d)return;b[c].pool.push(a)},a}(),me.ObjectEntity=me.Renderable.extend({GUID:null,type:0,collidable:!0,collisionBox:null,renderable:null,z:0,init:function(a,b,c){this.parent(new me.Vector2d(a,b),~~c.spritewidth||~~c.width,~~c.spriteheight||~~c.height);if(c.image){var d=typeof c.image=="string"?me.loader.getImage(c.image):c.image;this.renderable=new me.AnimationSheet(0,0,d,~~c.spritewidth,~~c.spriteheight,~~c.spacing,~~c.margin),c.transparent_color&&this.renderable.setTransparency(c.transparent_color)}this.GUID=me.utils.createGUID(),this.name=c.name?c.name.toLowerCase():"",this.vel=new me.Vector2d,this.accel=new me.Vector2d,this.friction=new me.Vector2d,this.maxVel=new me.Vector2d(1e3,1e3),this.gravity=me.sys.gravity!=undefined?me.sys.gravity:.98,this.isEntity=!0,this.alive=!0,this.visible=!0,this.floating=!1,this.isPersistent=!1,this.falling=!1,this.jumping=!0,this.slopeY=0,this.onslope=!1,this.onladder=!1,this.disableTopLadderCollision=!1,this.collidable=typeof c.collidable!="undefined"?c.collidable:!0,this.type=c.type||0,this.collisionMap=me.game.collisionMap,this.collisionBox=new me.Rect(this.pos,this.width,this.height),this.canBreakTile=!1,this.onTileBreak=null},updateColRect:function(a,b,c,d){this.collisionBox.adjustSize(a,b,c,d)},onCollision:function(a,b){this.collidable&&this.type==me.game.COLLECTABLE_OBJECT&&me.game.remove(this)},setVelocity:function(a,b){this.accel.x=a!=0?a:this.accel.x,this.accel.y=b!=0?b:this.accel.y,this.setMaxVelocity(a,b)},setMaxVelocity:function(a,b){this.maxVel.x=a,this.maxVel.y=b},setFriction:function(a,b){this.friction.x=a||0,this.friction.y=b||0},flipX:function(a){a!=this.lastflipX&&(this.renderable&&this.renderable.flipX(a),this.collisionBox.flipX(this.width))},flipY:function(a){a!=this.lastflipY&&(this.renderable&&this.renderable.flipY(a),this.collisionBox.flipY(this.height))},doWalk:function(a){this.flipX(a),this.vel.x+=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick},doClimb:function(a){return this.onladder?(this.vel.y=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick,this.disableTopLadderCollision=!a,!0):!1},doJump:function(){return!this.jumping&&!this.falling?(this.vel.y=-this.maxVel.y*me.timer.tick,this.jumping=!0,!0):!1},forceJump:function(){this.jumping=this.falling=!1,this.doJump()},distanceTo:function(a){var b=this.pos.x+this.hWidth-(a.pos.x+a.hWidth),c=this.pos.y+this.hHeight-(a.pos.y+a.hHeight);return Math.sqrt(b*b+c*c)},distanceToPoint:function(a){var b=this.pos.x+this.hWidth-a.x,c=this.pos.y+this.hHeight-a.y;return Math.sqrt(b*b+c*c)},angleTo:function(a){var b=a.pos.x+a.hWidth-(this.pos.x+this.hWidth),c=a.pos.y+a.hHeight-(this.pos.y+this.hHeight);return Math.atan2(c,b)},angleToPoint:function(a){var b=a.x-(this.pos.x+this.hWidth),c=a.y-(this.pos.y+this.hHeight);return Math.atan2(c,b)},checkSlope:function(a,b){this.pos.y=a.pos.y-this.height,b?this.slopeY=a.height-(this.collisionBox.right+this.vel.x-a.pos.x):this.slopeY=this.collisionBox.left+this.vel.x-a.pos.x,this.vel.y=0,this.pos.y+=this.slopeY.clamp(0,a.height)},computeVelocity:function(a){this.gravity&&(a.y+=this.onladder?0:this.gravity*me.timer.tick,this.falling=a.y>0,this.jumping=this.falling?!1:this.jumping),this.friction.x&&(a.x=me.utils.applyFriction(a.x,this.friction.x)),this.friction.y&&(a.y=me.utils.applyFriction(a.y,this.friction.y)),a.y!=0&&(a.y=a.y.clamp(-this.maxVel.y,this.maxVel.y)),a.x!=0&&(a.x=a.x.clamp(-this.maxVel.x,this.maxVel.x))},updateMovement:function(){this.computeVelocity(this.vel);if(this.collidable){var a=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onslope=a.yprop.isSlope||a.xprop.isSlope,this.onladder=!1,a.y&&(this.onladder=a.yprop.isLadder||a.yprop.isTopLadder,a.y>0?a.yprop.isSolid||a.yprop.isPlatform&&this.collisionBox.bottom-1<=a.ytile.pos.y||a.yprop.isTopLadder&&!this.disableTopLadderCollision?(this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1):a.yprop.isSlope&&!this.jumping?(this.checkSlope(a.ytile,a.yprop.isLeftSlope),this.falling=!1):a.yprop.isBreakable&&(this.canBreakTile?(me.game.currentLevel.clearTile(a.ytile.col,a.ytile.row),this.onTileBreak&&this.onTileBreak()):(this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1)):a.y<0&&!a.yprop.isPlatform&&!a.yprop.isLadder&&!a.yprop.isTopLadder&&(this.falling=!0,this.vel.y=0)),a.x&&(this.onladder=a.xprop.isLadder||a.yprop.isTopLadder,a.xprop.isSlope&&!this.jumping?(this.checkSlope(a.xtile,a.xprop.isLeftSlope),this.falling=!1):!a.xprop.isPlatform&&!a.xprop.isLadder&&!a.xprop.isTopLadder&&(a.xprop.isBreakable&&this.canBreakTile?(me.game.currentLevel.clearTile(a.xtile.col,a.xtile.row),this.onTileBreak&&this.onTileBreak()):this.vel.x=0))}return this.pos.add(this.vel),a},collide:function(a){return me.game.collide(this,a||!1)},collideType:function(a,b){return me.game.collideType(this,a,b||!1)},update:function(){return this.renderable?this.renderable.update():!1},getRect:function(){return this.renderable?this.renderable.getRect().translateV(this.pos):null},draw:function(a){if(this.renderable){var b=~~(this.pos.x+this.anchorPoint.x*(this.width-this.renderable.width)),c=~~(this.pos.y+this.anchorPoint.y*(this.height-this.renderable.height));a.translate(b,c),this.renderable.draw(a),a.translate(-b,-c)}if(me.debug.renderHitBox&&this.collisionBox){this.collisionBox.draw(a,"red");var b=~~(this.pos.x+this.hWidth),c=~~(this.pos.y+this.hHeight);a.lineWidth=1,a.beginPath(),a.moveTo(b,c),a.lineTo(b+~~(this.vel.x*this.hWidth),c+~~(this.vel.y*this.hHeight)),a.stroke()}},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.renderable=null),this.onDestroyEvent.apply(this,arguments),this.pos=null,this.collisionBox=null},onDestroyEvent:function(){}}),me.CollectableEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.type=me.game.COLLECTABLE_OBJECT}}),me.LevelEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.nextlevel=c.to,this.fade=c.fade,this.duration=c.duration,this.fading=!1,this.gotolevel=c.to},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel),me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(a){this.gotolevel=a||this.nextlevel,this.fade&&this.duration?this.fading||(this.fading=!0,me.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):me.levelDirector.loadLevel(this.gotolevel)},onCollision:function(){this.goTo()}})}(window),function(a){me.ScreenObject=me.Renderable.extend({addAsObject:!1,z:999,init:function(a,b){this.parent(new me.Vector2d(0,0),0,0),this.addAsObject=this.visible=a===!0||!1,this.isPersistent=this.visible&&b===!0||!1},reset:function(){me.game.reset(),this.onResetEvent.apply(this,arguments),this.addAsObject&&(this.visible=!0,this.set(me.game.viewport.pos,me.game.viewport.width,me.game.viewport.height),me.game.add(this,this.z)),me.game.sort()},destroy:function(){this.onDestroyEvent.apply(this,arguments)},update:function(){return!1},onUpdateFrame:function(){me.timer.update(),me.game.update(),me.game.draw(),me.video.blitSurface()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}}),me.state=function(){function m(){if(f==-1&&g==-1){me.timer.reset();if(me.sys.useNativeAnimFrame){g=window.requestAnimationFrame(n);if(g!=-1)return;me.sys.useNativeAnimFrame=!1}f=setInterval(l,~~(1e3/me.sys.fps))}}function n(){l(),g!=-1&&(g=window.requestAnimationFrame(n))}function o(){f!=-1&&(clearInterval(f),f=-1),g!=-1&&(window.cancelAnimationFrame(g),g=-1)}function p(a){o(),h[e]&&(h[e].screen.visible&&me.game.remove.call(me.game,h[e].screen,!0),h[e].screen.destroy()),h[a]&&(e=a,h[e].screen.reset.apply(h[e].screen,k),l=h[e].screen.onUpdateFrame.bind(h[e].screen),m(),j&&j(),me.game.repaint())}var b=["ms","moz","webkit","o"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a,b){return-1}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return-1});var d={},e=-1,f=-1,g=-1,h={},i={color:"",duration:0},j=null,k=null,l=null;return d.LOADING=0,d.MENU=1,d.READY=2,d.PLAY=3,d.GAMEOVER=4,d.GAME_END=5,d.SCORE=6,d.CREDITS=7,d.SETTINGS=8,d.USER=100,d.onPause=null,d.onResume=null,d.init=function(){d.set(d.LOADING,me.loadingScreen),a.addEventListener("blur",function(){me.sys.pauseOnBlur&&e!=d.LOADING&&d.pause(!0),d.onPause&&d.onPause(),me.event.publish(me.event.STATE_PAUSE)},!1),a.addEventListener("focus",function(){me.sys.pauseOnBlur&&e!=d.LOADING&&(d.resume(!0),me.game.repaint()),d.onResume&&d.onResume(),me.event.publish(me.event.STATE_RESUME)},!1)},d.pause=function(a){o(),a&&me.audio.pauseTrack()},d.resume=function(a){m(),a&&me.audio.resumeTrack()},d.isRunning=function(){return f!=-1||g!=-1},d.set=function(a,b){h[a]={},h[a].screen=b,h[a].transition=!0},d.current=function(){return h[e].screen},d.transition=function(a,b,c){a=="fade"&&(i.color=b,i.duration=c)},d.setTransition=function(a,b){h[a].transition=b},d.change=function(a){k=null,arguments.length>1&&(k=Array.prototype.slice.call(arguments,1)),i.duration&&h[a].transition?(j=function(){me.game.viewport.fadeOut(i.color,i.duration)},me.game.viewport.fadeIn(i.color,i.duration,function(){p.defer(a)})):p.defer(a)},d.isCurrent=function(a){return e==a},d}()}(window),function(a){me.DefaultLoadingScreen=me.ScreenObject.extend({init:function(){this.parent(!0),this.invalidate=!1,this.handle=null},onResetEvent:function(){this.logo1=new me.Font("century gothic",32,"white","middle"),this.logo2=new me.Font("century gothic",32,"#89b002","middle"),this.logo2.bold(),this.logo1.textBaseline=this.logo2.textBaseline="alphabetic",this.handle=me.event.subscribe(me.event.LOADER_PROGRESS,this.onProgressUpdate.bind(this)),this.loadPercent=0},onDestroyEvent:function(){this.logo1=this.logo2=null,this.handle&&(me.event.unsubscribe(this.handle),this.handle=null)},onProgressUpdate:function(a){this.loadPercent=a,this.invalidate=!0},update:function(){return this.invalidate===!0?(this.invalidate=!1,!0):!1},draw:function(a){var b=this.logo1.measureText(a,"melon").width,c=(me.video.getWidth()-b-this.logo2.measureText(a,"JS").width)/2,d=me.video.getHeight()/2;me.video.clearSurface(a,"black"),this.logo1.draw(a,"melon",c,d),c+=b,this.logo2.draw(a,"JS",c,d),d+=this.logo1.measureText(a,"melon").height/2;var e=Math.floor(this.loadPercent*me.video.getWidth());a.strokeStyle="silver",a.strokeRect(0,d,me.video.getWidth(),6),a.fillStyle="#89b002",a.fillRect(2,d+2,e-4,2)}}),me.loader=function(){function i(){g==f?a.onload?(clearTimeout(h),setTimeout(function(){a.onload(),me.event.publish(me.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):h=setTimeout(i,100)}function j(a,c,d){b[a.name]=new Image,b[a.name].onload=c,b[a.name].onerror=d,b[a.name].src=a.src+me.nocache}function k(a,b,d){var e=new XMLHttpRequest,f=me.utils.getFileExtension(a.src).toLowerCase();e.overrideMimeType&&(f==="json"?e.overrideMimeType("application/json"):e.overrideMimeType("text/xml")),e.open("GET",a.src+me.nocache,!0),e.ontimeout=d,e.onreadystatechange=function(){if(e.readyState==4)if(e.status==200||e.status==0&&e.responseText){var g=null;switch(f){case"xml":case"tmx":me.sys.ua.toLowerCase().contains("msie")||!e.responseXML?g=(new DOMParser).parseFromString(e.responseText,"text/xml"):g=e.responseXML,f="xml";break;case"json":g=JSON.parse(e.responseText);break;default:throw"melonJS: TMX file format "+f+"not supported !"}c[a.name]={data:g,isTMX:a.type==="tmx",format:f},a.type==="tmx"&&me.levelDirector.addTMXLevel(a.name),b()}else d()},e.send(null)}function l(a,b,c){var d=new XMLHttpRequest;d.overrideMimeType&&d.overrideMimeType("application/json"),d.open("GET",a.src+me.nocache,!0),d.ontimeout=c,d.onreadystatechange=function(){d.readyState==4&&(d.status==200||d.status==0&&d.responseText?(e[a.name]=JSON.parse(d.responseText),b()):c())},d.send(null)}function m(a,b,c){var e=new XMLHttpRequest;e.open("GET",a.src+me.nocache,!1),e.responseType="arraybuffer",e.onerror=c,e.onload=function(c){var f=e.response;if(f){var g=new Uint8Array(f),h=[];d[a.name]=new dataType;for(var i=0;i<g.byteLength;i++)h[i]=String.fromCharCode(g[i]);d[a.name].data=h.join(""),b()}},e.send()}var a={},b={},c={},d={},e={},f=0,g=0,h=0;return a.onload=undefined,a.onProgress=undefined,a.onResourceLoaded=function(b){g++;var c=a.getLoadProgress();a.onProgress&&a.onProgress(c),me.event.publish(me.event.LOADER_PROGRESS,[c])},a.onLoadingError=function(a){throw"melonJS: Failed loading resource "+a.src},a.preload=function(b){for(var c=0;c<b.length;c++)f+=a.load(b[c],a.onResourceLoaded.bind(a),a.onLoadingError.bind(a,b[c]));i()},a.load=function(a,b,c){a.name=a.name.toLowerCase();switch(a.type){case"binary":return m.call(this,a,b,c),1;case"image":return j.call(this,a,b,c),1;case"tps":return l.call(this,a,b,c),1;case"tmx":case"tsx":return k.call(this,a,b,c),1;case"audio":if(me.audio.isAudioEnable())return me.audio.load(a,b,c),1;break;default:throw"melonJS: me.loader.load : unknown or invalid resource type : "+a.type}return 0},a.unload=function(a){a.name=a.name.toLowerCase();switch(a.type){case"binary":if(!(a.name in d))return!1;return delete d[a.name],!0;case"image":if(!(a.name in b))return!1;return delete b[a.name],!0;case"tps":if(!(a.name in e))return!1;return delete e[a.name],!0;case"tmx":case"tsx":if(!(a.name in c))return!1;return delete c[a.name],!0;case"audio":return me.audio.unload(a.name);default:throw"melonJS: me.loader.unload : unknown or invalid resource type : "+a.type}},a.unloadAll=function(){var e;for(e in d)a.unload(e);for(e in b)a.unload(e);for(e in c)a.unload(e);me.audio.unloadAll()},a.getTMXFormat=function(a){return a=a.toLowerCase(),a in c?c[a].format:null},a.getTMX=function(a){return a=a.toLowerCase(),a in c?c[a].data:null},a.getBinary=function(a){return a=a.toLowerCase(),a in d?d[a]:null},a.getAtlas=function(a){return a=a.toLowerCase(),a in e?e[a]:null},a.getImage=function(a){a=a.toLowerCase();if(a in b){if(me.sys.cacheImage===!0){var c=me.video.createCanvasSurface(b[a].width,b[a].height);return c.drawImage(b[a],0,0),c.canvas}return b[a]}return null},a.getLoadProgress=function(){return g/f},a}()}(window),function(a){me.Font=Object.extend({font:null,height:null,color:null,textAlign:"left",textBaseline:"top",lineHeight:1,init:function(a,b,c,d){this.set(a,b,c,d)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(a,b,c,d){var e=a.split(",");for(var f=0;f<e.length;f++)e[f]="'"+e[f]+"'";this.height=parseInt(b),typeof b=="number"&&(b=""+b+"px"),this.font=b+" "+e.join(","),this.color=c,d&&(this.textAlign=d)},getRect:function(){return new me.Rect(new Vector2d(0,0),0,0)},measureText:function(a,b){a.font=this.font,a.fillStyle=this.color,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;var c=(""+b).split("\n"),d=0,e=0;for(var f=0;f<c.length;f++)d=Math.max(a.measureText(c[f].trim()).width,d),e+=this.height*this.lineHeight;return{width:d,height:e}},draw:function(a,b,c,d){a.font=this.font,a.fillStyle=this.color,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;var e=(""+b).split("\n");for(var f=0;f<e.length;f++)a.fillText(e[f].trim(),~~c,~~d),d+=this.height*this.lineHeight}}),me.BitmapFont=me.Font.extend({size:null,sSize:null,firstChar:32,charCount:0,init:function(a,b,c,d){this.parent(a,null,null),this.size=new me.Vector2d,this.sSize=new me.Vector2d,this.firstChar=d||32,this.loadFontMetrics(a,b),this.textAlign="left",this.textBaseline="top",c&&this.resize(c)},loadFontMetrics:function(a,b){this.font=me.loader.getImage(a),this.size.x=b.x||b,this.size.y=b.y||this.font.height,this.sSize.copy(this.size),this.charCount=~~(this.font.width/this.size.x)},set:function(a,b){this.textAlign=a,b&&this.resize(b)},resize:function(a){this.sSize.setV(this.size),this.sSize.x*=a,this.sSize.y*=a},measureText:function(a,b){var c=(""+b).split("\n"),d=0,e=0;for(var f=0;f<c.length;f++)d=Math.max(c[f].trim().length*this.sSize.x,d),e+=this.sSize.y*this.lineHeight;return{width:d,height:e}},draw:function(a,b,c,d){var e=(""+b).split("\n"),f=c,g=this.sSize.y*this.lineHeight;for(var h=0;h<e.length;h++){var c=f,d=d,i=e[h].trim(),j=i.length*this.sSize.x;switch(this.textAlign){case"right":c-=j;break;case"center":c-=j*.5;break;default:}switch(this.textBaseline){case"middle":d-=g*.5;break;case"ideographic":case"alphabetic":case"bottom":d-=g;break;default:}for(var k=0,l=i.length;k<l;k++){var m=i.charCodeAt(k)-this.firstChar;a.drawImage(this.font,this.size.x*(m%this.charCount),this.size.y*~~(m/this.charCount),this.size.x,this.size.y,~~c,~~d,this.sSize.x,this.sSize.y),c+=this.sSize.x}d+=g}}})}(window),function(a){me.GUI_Object=me.SpriteObject.extend({isClickable:!0,updated:!1,init:function(a,b,c){this.parent(a,b,typeof c.image=="string"?me.loader.getImage(c.image):c.image,c.spritewidth,c.spriteheight),this.floating=!0,me.input.registerMouseEvent("mousedown",this,this.clicked.bind(this))},update:function(){return this.updated?(this.updated=!1,!0):!1},clicked:function(){if(this.isClickable)return this.updated=!0,this.onClick()},onClick:function(){return!0},onDestroyEvent:function(){me.input.releaseMouseEvent("mousedown",this)}})}(window),function(a){me.HUD_Item=Object.extend({init:function(a,b,c){this.pos=new me.Vector2d(a||0,b||0),this.visible=!0,this.defaultvalue=c||0,this.value=c||0,this.updated=!0},reset:function(){this.set(this.defaultvalue)},set:function(a){return this.value=a,this.updated=!0,!0},update:function(a){return this.set(this.value+a)},draw:function(a,b,c){}}),me.HUD_Object=me.Renderable.extend({init:function(a,b,c,d,e){this.parent(new me.Vector2d(a||0,b||0),c||me.video.getWidth(),d||me.video.getHeight()),this.bgcolor=e,this.HUDItems={},this.HUDobj=[],this.objCount=0,this.visible=!0,this.floating=!0,this.HUD_invalidated=!0,this.HUDCanvas=me.video.createCanvas(this.width,this.height),this.HUDCanvasSurface=this.HUDCanvas.getContext("2d"),this.z=999,this.isPersistent=!0},addItem:function(a,b){this.HUDItems[a]=b,this.HUDobj.push(this.HUDItems[a]),this.objCount++,this.HUD_invalidated=!0},removeItem:function(a){this.HUDItems[a]&&(this.HUDobj.splice(this.HUDobj.indexOf(this.HUDItems[a]),1),this.HUDItems[a]=null,this.objCount--,this.HUD_invalidated=!0)},setItemValue:function(a,b){this.HUDItems[a]&&this.HUDItems[a].set(b)==1&&(this.HUD_invalidated=!0)},updateItemValue:function(a,b){this.HUDItems[a]&&this.HUDItems[a].update(b)==1&&(this.HUD_invalidated=!0)},getItemValue:function(a){return this.HUDItems[a]?this.HUDItems[a].value:0},update:function(){return this.HUD_invalidated},reset:function(a){a!=undefined?(this.HUDItems[a]&&this.HUDItems[a].reset(),this.HUD_invalidated=!0):this.resetAll()},resetAll:function(){for(var a=this.objCount,b;a--,b=this.HUDobj[a];)b.reset();this.HUD_invalidated=!0},draw:function(a){if(this.HUD_invalidated){this.bgcolor?me.video.clearSurface(this.HUDCanvasSurface,this.bgcolor):this.HUDCanvas.width=this.HUDCanvas.width;for(var b=this.objCount,c;b--,c=this.HUDobj[b];)c.visible&&(c.draw(this.HUDCanvasSurface,0,0),c.updated&&(c.updated=!1))}a.drawImage(this.HUDCanvas,this.pos.x,this.pos.y),this.HUD_invalidated=!1}})}(window),function(a){me.audio=function(){function l(b){var c="",d=b.length;if(me.sys.sound){var e="";for(var g=0;g<d;g++){e=b[g].toLowerCase().trim();if(a.capabilities[e]&&a.capabilities[e].canPlay&&(c===""||a.capabilities[e].canPlayType==="probably")){c=e;if(a.capabilities[e].canPlayType==="probably")break}}}return c===""&&(f=!1),c}function m(a){var c=b[a];for(var d=0,e;e=c[d++];)if(e.ended||!e.currentTime)return e.currentTime=g,e;return c[0].pause(),c[0].currentTime=g,c[0]}function n(a,d){if(h++>3){var e="melonJS: failed loading "+a+"."+c;if(me.sys.stopOnAudioError===!1)me.audio.disable(),d&&d(),console.log(e+", disabling audio");else throw e}else b[a][0].load()}function o(a,c,d){h=0;if(c>1){var e=b[a][0];for(var f=1;f<c;f++)b[a][f]=new Audio(e.src),b[a][f].preload="auto",b[a][f].load()}d&&d()}function p(a,b,c,d){var e=m(a.toLowerCase());return e.loop=b||!1,e.volume=d?parseFloat(d).clamp(0,1):i.volume,e.muted=i.muted,e.play(),c&&!b&&e.addEventListener("ended",function(a){e.removeEventListener("ended",arguments.callee,!1),c()},!1),e}function q(a,b,c){return c&&!b&&setTimeout(c,2e3),null}var a={},b={},c=-1,d=null,e=null,f=!0,g=0,h=0,i={volume:1,muted:!1},j=!1,k=[];return a.capabilities={mp3:{codec:"audio/mpeg",canPlay:!1,canPlayType:"no"},ogg:{codec:'audio/ogg; codecs="vorbis"',canPlay:!1,canPlayType:"no"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',canPlay:!1,canPlayType:"no"},wav:{codec:'audio/wav; codecs="1"',canPlay:!1,canPlayType:"no"}},a.detectCapabilities=function(){var b=document.createElement("audio");if(b.canPlayType)for(var c in a.capabilities){var d=b.canPlayType(a.capabilities[c].codec);d!==""&&d!=="no"&&(a.capabilities[c].canPlay=!0,a.capabilities[c].canPlayType=d),me.sys.sound|=a.capabilities[c].canPlay}},a.init=function(b){if(!me.initialized)throw"melonJS: me.audio.init() called before engine initialization.";return b=new String(b?b:"mp3"),b=b.split(","),c=l(b),me.sys.isMobile&&!navigator.isCocoonJS&&(f=!1),a.play=a.isAudioEnable()?p:q,a.isAudioEnable()},a.isAudioEnable=function(){return f},a.enable=function(){f=me.sys.sound,f?a.play=p:a.play=q},a.disable=function(){me.audio.stopTrack(),a.play=q,f=!1},a.load=function(d,e,f){if(c==-1)return 0;if(me.sys.isMobile&&!navigator.isCocoonJS){if(j){k.push([d,e,f]);return}j=!0}var g=d.channel||1,h="canplaythrough";d.stream===!0&&!me.sys.isMobile&&(g=1,h="canplay");var i=new Audio(d.src+d.name+"."+c+me.nocache);return i.preload="auto",i.addEventListener(h,function(b){i.removeEventListener(h,arguments.callee,!1),j=!1,o.call(me.audio,d.name,g,e);var c=k.shift();c&&a.load.apply(a,c)},!1),i.addEventListener("error",function(a){n.call(me.audio,d.name,f)},!1),i.load(),b[d.name]=[i],1},a.stop=function(a){if(f){var c=b[a.toLowerCase()];for(var d=c.length;d--;)c[d].pause(),c[d].currentTime=g}},a.pause=function(a){if(f){var c=b[a.toLowerCase()];for(var d=c.length;d--;)c[d].pause()}},a.playTrack=function(a,b){e=me.audio.play(a,!0,null,b),d=a.toLowerCase()},a.stopTrack=function(){f&&e&&(e.pause(),d=null,e=null)},a.setVolume=function(a){a&&(i.volume=parseFloat(a).clamp(0,1))},a.getVolume=function(){return i.volume},a.mute=function(a,c){c=c===undefined?!0:!!c;var d=b[a.toLowerCase()];for(var e=0,f;f=d[e++];)f.muted=c},a.unmute=function(b){a.mute(b,!1)},a.muteAll=function(){i.muted=!0;for(var c in b)a.mute(c,i.muted)},a.unmuteAll=function(){i.muted=!1;for(var c in b)a.mute(c,i.muted)},a.getCurrentTrack=function(){return d},a.pauseTrack=function(){f&&e&&e.pause()},a.resumeTrack=function(){f&&e&&e.play()},a.unload=function(c){return c=c.toLowerCase(),c in b?(d===c?a.stopTrack():a.stop(c),delete b[c],!0):!1},a.unloadAll=function(){for(var c in b)a.unload(c)},a}()}(window),function(a){me.timer=function(){function k(a){b.replaceChild(document.createTextNode("("+a+"/"+me.sys.fps+" fps)"),b.firstChild)}var a={},b=null,c=!1,d=0,e=0,f=0,g=0,h=0,i=Math.ceil(1e3/me.sys.fps),j=1e3/me.sys.fps*1.25;return a.tick=1,a.fps=0,a.init=function(){b=document.getElementById("framecounter"),b!==null&&(me.debug.displayFPS=!0),a.reset()},a.reset=function(){g=f=Date.now(),e=0,d=0},a.getTime=function(){return g},a.update=function(){f=g,g=Date.now(),h=g-f,me.debug.displayFPS&&(d++,e+=h,d%10==0&&(this.fps=(~~(1e3*d/e)).clamp(0,me.sys.fps),e=0,d=0),b!==null&&k(this.fps)),a.tick=h>j&&me.sys.interpolation?h/i:1},a}(),me.video=function(){function m(){return navigator.isCocoonJS&&!me.sys.dirtyRegion?"screencanvas":"canvas"}var a={},b=null,c=null,d=null,e=null,f=null,g=-1,h=!1,i=0,j=0,k=!1,l=!0;return a.init=function(g,m,n,o,p,q){if(!me.initialized)throw"melonJS: me.video.init() called before engine initialization.";h=o||!1,k=p==="auto"||!1,l=q!==undefined?q:!0,p=p!=="auto"?parseFloat(p||1):1,me.sys.scale=new me.Vector2d(p,p);if(k||p!==1)h=!0;return i=m*me.sys.scale.x,j=n*me.sys.scale.y,window.addEventListener("resize",function(a){me.event.publish(me.event.WINDOW_ONRESIZE,[a])},!1),window.addEventListener("orientationchange",function(a){me.event.publish(me.event.WINDOW_ONRESIZE,[a])},!1),me.event.subscribe(me.event.WINDOW_ONRESIZE,me.video.onresize.bind(me.video)),b=a.createCanvas(i,j,!0),g&&(f=document.getElementById(g)),f||(f=document.body),f.appendChild(b),b.getContext?(c=b.getContext("2d"),h?(d=a.createCanvas(m,n,!1),e=d.getContext("2d")):(d=b,e=c),k&&me.video.onresize(null),!0):!1},a.getWrapper=function(){return f},a.getWidth=function(){return d.width},a.getPos=function(a){var c=a||b,d=new me.Vector2d(c.offsetLeft,c.offsetTop);while(c=c.offsetParent)d.x+=c.offsetLeft,d.y+=c.offsetTop;return d},a.getHeight=function(){return d.height},a.createCanvas=function(a,b,c){if(a===0||b===0)throw new Error("melonJS: width or height was zero, Canvas could not be initialized !");var e=c===!0?m():"canvas",f=document.createElement(e);return f.width=a||d.width,f.height=b||d.height,f},a.createCanvasSurface=function(b,c){return a.createCanvas(b,c,!1).getContext("2d")},a.getScreenCanvas=function(){return b},a.getScreenContext=function(){return c},a.getSystemCanvas=function(){return d},a.getSystemContext=function(){return e},a.onresize=function(a){if(k){var b=me.video.getScreenCanvas().parentNode,c=b.width||window.innerWidth,d=b.height||window.innerHeight;g&&clearTimeout(g);if(l){var e=me.video.getWidth()/me.video.getHeight(),f=c/d;if(f<e)var h=c/me.video.getWidth();else var h=d/me.video.getHeight();g=me.video.updateDisplaySize.defer(h,h)}else g=me.video.updateDisplaySize.defer(c/me.video.getWidth(),d/me.video.getHeight());return}me.input.mouse.offset=me.video.getPos()},a.updateDisplaySize=function(c,e){me.sys.scale.set(c,e),b.width=i=d.width*c,b.height=j=d.height*e,me.input.mouse.offset=me.video.getPos(),a.blitSurface(),g=-1},a.clearSurface=function(b,c){b.save(),b.setTransform(1,0,0,1,0,0),b.fillStyle=c,b.fillRect(0,0,a.getWidth(),a.getHeight()),b.restore()},a.scale=function(a,b){a.translate(-(a.canvas.width*b-a.canvas.width>>1),-(a.canvas.height*b-a.canvas.height>>1)),a.scale(b,b)},a.setImageSmoothing=function(a){var b=["ms","moz","webkit","o"];for(var d=0;d<b.length;++d)c[b[d]+"ImageSmoothingEnabled"]!==undefined&&(c[b[d]+"ImageSmoothingEnabled"]=a,h&&(e[b[d]+"ImageSmoothingEnabled"]=a));c.imageSmoothingEnabled=a,h&&(e.imageSmoothingEnabled=a)},a.setAlpha=function(a,b){a.globalCompositeOperation=b?"source-over":"copy"},a.blitSurface=function(){h?a.blitSurface=function(){c.drawImage(d,0,0,d.width,d.height,0,0,i,j)}:a.blitSurface=function(){},a.blitSurface()},a.applyRGBFilter=function(b,c,d){var e=a.createCanvasSurface(b.width,b.height,!1),f=me.utils.getPixels(b),g=f.data;switch(c){case"b&w":for(var h=0,i=g.length;h<i;h+=4){var j=3*g[h]+4*g[h+1]+g[h+2]>>>3;g[h]=j,g[h+1]=j,g[h+2]=j}break;case"brightness":var k=Math.abs(d).clamp(0,1);for(var h=0,i=g.length;h<i;h+=4)g[h]*=k,g[h+1]*=k,g[h+2]*=k;break;case"transparent":for(var h=0,i=g.length;h<i;h+=4)me.utils.RGBToHex(g[h],g[h+1],g[h+2])===d&&(g[h+3]=0);break;default:return null}return e.putImageData(f,0,0),e},a}()}(window),function(a){me.input=function(){function l(){g||(a.addEventListener("keydown",o,!1),a.addEventListener("keyup",p,!1),g=!0)}function m(){if(!h){b.touches.push({x:0,y:0}),b.mouse.pos=new me.Vector2d(0,0),b.mouse.offset=me.video.getPos();if(me.sys.touch){me.video.getScreenCanvas().addEventListener("touchmove",t,!1);for(var c=2;c<k.length;++c)me.video.getScreenCanvas().addEventListener(k[c],v,!1)}else{me.video.getScreenCanvas().addEventListener("mousemove",t,!1),a.addEventListener("mousewheel",s,!1);for(var c=2;c<j.length;++c)me.video.getScreenCanvas().addEventListener(j[c],u,!1)}h=!0}}function n(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function o(a,b){var g=c[b||a.keyCode||a.which];return g?(f[g]||(d[g]=!0,f[g]=e[g],me.event.publish(me.event.KEYDOWN,[g])),n(a)):!0}function p(a,b){var e=c[b||a.keyCode||a.which];return e?(d[e]=!1,f[e]=!1,me.event.publish(me.event.KEYUP,[e]),n(a)):!0}function q(a){var c=!1,d=b.mouse.handlers[a.type];if(d){var e=me.game.viewport.pos,f=me.game.currentLevel.pos;for(var g=0,h=b.touches.length;g<h;g++){var i=b.touches[g].x,j=b.touches[g].y;for(var k=d.length,l;k--,l=d[k];){if(l.floating===!1)var m={x:i+e.x-f.x,y:j+e.y-f.y};else var m={x:i,y:j};if(l.rect===null||l.rect.containsPoint(m))if(l.cb(a)===!1){c=!0;break}}}}return c}function r(a){b.touches.length=0;if(!a.touches){var c=b.mouse.offset,d=a.pageX-c.x,e=a.pageY-c.y,f=me.sys.scale;if(f.x!=1||f.y!=1)d/=f.x,e/=f.y;b.touches.push({x:d,y:e,id:0})}else{var c=b.mouse.offset;for(var g=0,h=a.changedTouches.length;g<h;g++){var i=a.changedTouches[g],d=i.clientX-c.x,e=i.clientY-c.y,f=me.sys.scale;if(f.x!=1||f.y!=1)d/=f.x,e/=f.y;b.touches.push({x:d,y:e,id:i.identifier})}}b.mouse.pos.set(b.touches[0].x,b.touches[0].y)}function s(a){return a.target==me.video.getScreenCanvas()&&q(a)?n(a):!0}function t(a){return r(a),q(a)?n(a):!0}function u(a){if(q(a))return n(a);var c=b.mouse.bind[a.button||0];return c?a.type==="mousedown"||a.type==="touchstart"?o(a,c):p(a,c):!0}function v(a){return r(a),u(a)}function w(a){b.accel=a.accelerationIncludingGravity}var b={},c={},d={},e={},f={},g=!1,h=!1,i=!1,j=["mousewheel","mousemove","mousedown","mouseup","click","dblclick"],k=[undefined,"touchmove","touchstart","touchend","tap","dbltap"];return b.accel={x:0,y:0,z:0},b.mouse={pos:null,offset:null,LEFT:0,MIDDLE:1,RIGHT:2,bind:[0,0,0],handlers:{}},b.touches=[],b.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},b.isKeyPressed=function(a){return d[a]?(e[a]&&(f[a]=!0,d[a]=!1),!0):!1},b.keyStatus=function(a){return f[a]===!0?!0:d[a]},b.triggerKeyEvent=function(a,b){b?o({},a):p({},a)},b.bindKey=function(a,b,g){l(),c[a]=b,d[b]=!1,e[b]=g?g:!1,f[b]=!1},b.unlockKey=function(a){f[a]=!1},b.unbindKey=function(a){d[c[a]]=!1,e[c[a]]=!1,c[a]=null},b.bindMouse=function(a,d){m();if(!c[d])throw"melonJS : no action defined for keycode "+d;b.mouse.bind[a]=d},b.unbindMouse=function(a){b.mouse.bind[a]=null},b.bindTouch=function(a){b.bindMouse(me.input.mouse.LEFT,a)},b.unbindTouch=function(){b.unbindMouse(me.input.mouse.LEFT)},b.registerMouseEvent=function(a,c,d,e){m(),me.sys.touch&&j.indexOf(a)!==-1&&(a=k[j.indexOf(a)]);if(!a||j.indexOf(a)===-1&&k.indexOf(a)===-1)throw"melonJS : invalid event type : "+a;b.mouse.handlers[a]||(b.mouse.handlers[a]=[]);var f=c.floating===!0?!0:!1;e&&(f=e===!0?!0:!1),b.mouse.handlers[a].push({rect:c||null,cb:d,floating:f});return},b.releaseMouseEvent=function(a,c){me.sys.touch&&j.indexOf(a)!==-1&&(a=k[j.indexOf(a)]);if(!a||j.indexOf(a)===-1&&k.indexOf(a)===-1)throw"melonJS : invalid event type : "+a;b.mouse.handlers[a]||(b.mouse.handlers[a]=[]);var d=b.mouse.handlers[a];if(d)for(var e=d.length,f;e--,f=d[e];)f.rect===c&&(f.rect=f.cb=f.floating=null,b.mouse.handlers[a].splice(e,1));return},b.watchAccelerometer=function(){return a.sys.gyro?(i||(a.addEventListener("devicemotion",w,!1),i=!0),!0):!1},b.unwatchAccelerometer=function(){i&&(a.removeEventListener("devicemotion",w,!1),i=!1)},b}()}(window),function(a){var b=function(){var b={},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return b.decode=function(b){b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");if(me.sys.nativeBase64)return a.atob(b);var d=[],e,f,g,h,i,j,k,l=0;while(l<b.length)h=c.indexOf(b.charAt(l++)),i=c.indexOf(b.charAt(l++)),j=c.indexOf(b.charAt(l++)),k=c.indexOf(b.charAt(l++)),e=h<<2|i>>4,f=(i&15)<<4|j>>2,g=(j&3)<<6|k,d.push(String.fromCharCode(e)),j!=64&&d.push(String.fromCharCode(f)),k!=64&&d.push(String.fromCharCode(g));return d=d.join(""),d},b}();me.utils=function(){var a={},c={},d="",e=0,f=/^.*(\\|\/|\:)/,g=/\.[^\.]*$/;return a.decodeBase64=function(a){return b.decode(a)},a.decodeBase64AsArray=function(a,c){c=c||1;var d=b.decode(a),e,f,g;if(typeof window.Uint32Array=="function")var h=new Uint32Array(d.length/c);else var h=[];for(e=0,g=d.length/c;e<g;e++){h[e]=0;for(f=c-1;f>=0;--f)h[e]+=d.charCodeAt(e*c+f)<<(f<<3)}return h},a.decompress=function(a,b){throw"melonJS: GZIP/ZLIB compressed TMX Tile Map not supported!"},a.decodeCSV=function(a,b){a=a.trim().split("\n");var c=[];for(var d=0;d<a.length;d++){entries=a[d].split(",",b);for(var e=0;e<entries.length;e++)c.push(+entries[e])}return c},a.getBasename=function(a){return a.replace(f,"").replace(g,"")},a.getFileExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)},a.setNocache=function(a){me.nocache=a?"?"+parseInt(Math.random()*1e7):""},a.HexToRGB=function(a,b){if(a.charAt(0)!=="#")return a;a=a.substring(1,a.length);if(c[a]==null){if(a.length<6)var d=a.charAt(0)+a.charAt(0),e=a.charAt(1)+a.charAt(1),f=a.charAt(2)+a.charAt(2);else var d=a.substring(0,2),e=a.substring(2,4),f=a.substring(4,6);c[a]=parseInt(d,16)+","+parseInt(e,16)+","+parseInt(f,16)}return(b?"rgba(":"rgb(")+c[a]+(b?","+b+")":")")},a.RGBToHex=function(a,b,c){return a.toHex()+b.toHex()+c.toHex()},a.getPixels=function(a){if(a instanceof HTMLImageElement){var b=me.video.createCanvasSurface(a.width,a.height);return b.drawImage(a,0,0),b.getImageData(0,0,a.width,a.height)}return a.getContext("2d").getImageData(0,0,a.width,a.height)},a.resetGUID=function(a){d=a.toString().toUpperCase().toHex(),e=0},a.createGUID=function(){return d+"-"+e++},a.applyFriction=function(a,b){return a+b<0?a+b*me.timer.tick:a-b>0?a-b*me.timer.tick:0},a}()}(window),function(a){function b(a){this.defaultvalue=a||0,this.value=a||0,this.updated=!0}b.prototype.reset=function(){this.set(this.defaultvalue)},b.prototype.update=function(a){return this.set(this.value+a)},b.prototype.set=function(a){return this.value=a,this.updated=!0,this.updated},me.gamestat=function(){var a={},c={},d=[],e=0;return a.add=function(a,f){var g=function(a,f){c[a]=new b(f),d.push(c[a]),e++};if(a.constructor===Object)for(var h in a)g(h,a[h]);else g(a,f)},a.updateValue=function(a,b){var d=function(a,b){c[a].update(b)};if(a.constructor===Object)for(var e in a)c[e]&&d(e,a[e]);else c[a]&&d(a,b)},a.setValue=function(a,b){var d=function(a,b){c[a].set(b)};if(a.constructor===Object)for(var e in a)c[e]&&d(e,a[e]);else c[a]&&d(a,b)},a.getItemValue=function(a){return c[a]?c[a].value:0},a.reset=function(b){b!=undefined?c[b]&&c[b].reset():a.resetAll()},a.resetAll=function(){for(var a=e,b;a--,b=d[a];)b.reset()},a}()}(window),function(a){me.COLLISION_LAYER="collision",me.TMX_TAG_MAP="map",me.TMX_TAG_NAME="name",me.TMX_TAG_VALUE="value",me.TMX_TAG_VERSION="version",me.TMX_TAG_ORIENTATION="orientation",me.TMX_TAG_WIDTH="width",me.TMX_TAG_HEIGHT="height",me.TMX_TAG_OPACITY="opacity",me.TMX_TAG_TRANS="trans",me.TMX_TAG_TILEWIDTH="tilewidth",me.TMX_TAG_TILEHEIGHT="tileheight",me.TMX_TAG_TILEOFFSET="tileoffset",me.TMX_TAG_FIRSTGID="firstgid",me.TMX_TAG_GID="gid",me.TMX_TAG_TILE="tile",me.TMX_TAG_ID="id",me.TMX_TAG_DATA="data",me.TMX_TAG_COMPRESSION="compression",me.TMX_TAG_GZIP="gzip",me.TMX_TAG_ZLIB="zlib",me.TMX_TAG_ENCODING="encoding",me.TMX_TAG_ATTR_BASE64="base64",me.TMX_TAG_CSV="csv",me.TMX_TAG_SPACING="spacing",me.TMX_TAG_MARGIN="margin",me.TMX_TAG_PROPERTIES="properties",me.TMX_TAG_PROPERTY="property",me.TMX_TAG_IMAGE="image",me.TMX_TAG_SOURCE="source",me.TMX_TAG_VISIBLE="visible",me.TMX_TAG_TILESET="tileset",me.TMX_TAG_LAYER="layer",me.TMX_TAG_TILE_LAYER="tilelayer",me.TMX_TAG_IMAGE_LAYER="imagelayer",me.TMX_TAG_OBJECTGROUP="objectgroup",me.TMX_TAG_OBJECT="object",me.TMX_TAG_X="x",me.TMX_TAG_Y="y",me.TMX_TAG_WIDTH="width",me.TMX_TAG_HEIGHT="height",me.TMX_TAG_POLYGON="polygon",me.TMX_TAG_POLYLINE="polyline",me.TMX_TAG_POINTS="points",me.TMX_BACKGROUND_COLOR="backgroundcolor"}(window),function(a){me.TMXUtils=function(){var a={};return a.applyTMXPropertiesFromXML=function(a,b){var c=b.getElementsByTagName(me.TMX_TAG_PROPERTIES)[0];if(c){var d=c.getElementsByTagName(me.TMX_TAG_PROPERTY);for(var e=0;e<d.length;e++){var f=me.mapReader.TMXParser.getStringAttribute(d[e],me.TMX_TAG_NAME),g=me.mapReader.TMXParser.getStringAttribute(d[e],me.TMX_TAG_VALUE);!g||g.isBoolean()?g=g?g=="true":!0:g.isNumeric()&&(g=Number(g)),a[f]=g}}},a.applyTMXPropertiesFromJSON=function(a,b){var c=b[me.TMX_TAG_PROPERTIES];if(c)for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];!e||e.isBoolean()?e=e?e=="true":!0:e.isNumeric()&&(e=Number(e)),a[d]=e}},a.mergeProperties=function(a,b,c){for(var d in b)if(c||a[d]===undefined)a[d]=b[d];return a},a}()}(window),function(a){me.TMXOBjectGroup=Object.extend({initFromXML:function(a,b,c,d){this.name=a,this.width=me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_WIDTH),this.height=me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_HEIGHT),this.visible=me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_VISIBLE,1)==1,this.z=d,this.objects=[],b.firstChild&&b.firstChild.nextSibling.nodeName===me.TMX_TAG_PROPERTIES&&me.TMXUtils.applyTMXPropertiesFromXML(this,b);var e=b.getElementsByTagName(me.TMX_TAG_OBJECT);for(var f=0;f<e.length;f++){var g=new me.TMXOBject;g.initFromXML(e[f],c,d),this.objects.push(g)}},initFromJSON:function(a,b,c,d){var e=this;this.name=a,this.width=b[me.TMX_TAG_WIDTH],this.height=b[me.TMX_TAG_HEIGHT],this.visible=b[me.TMX_TAG_VISIBLE],this.z=d,this.objects=[],me.TMXUtils.applyTMXPropertiesFromJSON(this,b),b.objects.forEach(function(a){var b=new me.TMXOBject;b.initFromJSON(a,c,d),e.objects.push(b)})},reset:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(a){return this.objects[a]}}),me.TMXOBject=Object.extend({initFromXML:function(a,b,c){this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME),this.x=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_X),this.y=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_Y),this.z=c,this.width=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH,0),this.height=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT,0),this.gid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_GID,null);if(this.gid)this.setImage(this.gid,b);else{var d=a.getElementsByTagName(me.TMX_TAG_POLYGON);this.isPolygon=!0,d.length||(d=a.getElementsByTagName(me.TMX_TAG_POLYLINE),this.isPolygon=!1);if(d.length){this.points=[];var e=me.mapReader.TMXParser.getStringAttribute(d[0],me.TMX_TAG_POINTS),f=e.split(" ");for(var g=0,h;g<f.length;g++)h=f[g].split(","),this.points[g]=new me.Vector2d(+h[0],+h[1])}}me.TMXUtils.applyTMXPropertiesFromXML(this,a)},initFromJSON:function(a,b,c){this.name=a[me.TMX_TAG_NAME],this.x=parseInt(a[me.TMX_TAG_X]),this.y=parseInt(a[me.TMX_TAG_Y]),this.z=parseInt(c),this.width=parseInt(a[me.TMX_TAG_WIDTH]||0),this.height=parseInt(a[me.TMX_TAG_HEIGHT]||0),this.gid=parseInt(a[me.TMX_TAG_GID])||null;if(this.gid)this.setImage(this.gid,b);else{var d=a[me.TMX_TAG_POLYGON];this.isPolygon=d!==undefined,d||(d=a[me.TMX_TAG_POLYLINE],this.isPolygon=!1);if(d){this.points=[];var e=this,f=0;d.forEach(function(a){e.points[f++]=new me.Vector2d(parseInt(a.x),parseInt(a.y))})}}me.TMXUtils.applyTMXPropertiesFromJSON(this,a)},setImage:function(a,b){var c=b.getTilesetByGid(this.gid);this.width=c.tilewidth,this.height=c.tileheight,this.spritewidth=this.width,this.y-=c.tileheight;var d=new me.Tile(this.x,this.y,c.tilewidth,c.tileheight,this.gid);this.image=c.getTileImage(d)},getObjectPropertyByName:function(a){return this[a]}})}(window),function(a){var b=2147483648,c=1073741824,d=536870912;me.Tile=me.Rect.extend({tileId:null,init:function(a,e,f,g,h){this.parent(new me.Vector2d(a*f,e*g),f,g),this.col=a,this.row=e,this.tileId=h,this.flipX=(this.tileId&b)!==0,this.flipY=(this.tileId&c)!==0,this.flipAD=(this.tileId&d)!==0,this.flipped=this.flipX||this.flipY||this.flipAD,this.tileId&=~(b|c|d)}}),me.TMXTileset=Object.extend({type:{SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",TOPLADDER:"topladder",BREAKABLE:"breakable"},init:function(){this.TileProperties=[],this.tileXOffset=[],this.tileYOffset=[]},initFromXML:function(a){this.firstgid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_FIRSTGID);var b=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_SOURCE);if(b){b=me.utils.getBasename(b),a=me.loader.getTMX(b);if(!a)throw"melonJS:"+b+" TSX tileset not found";me.mapReader.TMXParser.parseFromString(a),a=me.mapReader.TMXParser.getFirstElementByTagName("tileset")}this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME),this.tilewidth=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_TILEWIDTH),this.tileheight=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_TILEHEIGHT),this.spacing=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_SPACING,0),this.margin=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_MARGIN,0),this.tileoffset=new me.Vector2d(0,0);var c=a.getElementsByTagName(me.TMX_TAG_TILEOFFSET);c.length>0&&(this.tileoffset.x=me.mapReader.TMXParser.getIntAttribute(c[0],me.TMX_TAG_X),this.tileoffset.y=me.mapReader.TMXParser.getIntAttribute(c[0],me.TMX_TAG_Y));var d=a.getElementsByTagName(me.TMX_TAG_TILE);for(var e=0;e<d.length;e++){var f=me.mapReader.TMXParser.getIntAttribute(d[e],me.TMX_TAG_ID)+this.firstgid,g={};me.TMXUtils.applyTMXPropertiesFromXML(g,d[e]),this.setTileProperty(f,g)}var h=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),i=h?me.loader.getImage(me.utils.getBasename(h)):null;i||console.log("melonJS: '"+h+"' file for tileset '"+this.name+"' not found!");var j=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_TRANS);this.initFromImage(i,j)},initFromJSON:function(a){this.firstgid=a[me.TMX_TAG_FIRSTGID];var b=a[me.TMX_TAG_SOURCE];if(b){b=me.utils.getBasename(b);var a=me.loader.getTMX(b);if(!a)throw"melonJS:"+b+" TSX tileset not found"}this.name=a[me.TMX_TAG_NAME],this.tilewidth=parseInt(a[me.TMX_TAG_TILEWIDTH]),this.tileheight=parseInt(a[me.TMX_TAG_TILEHEIGHT]),this.spacing=parseInt(a[me.TMX_TAG_SPACING]||0),this.margin=parseInt(a[me.TMX_TAG_MARGIN]||0),this.tileoffset=new me.Vector2d(0,0);var c=a[me.TMX_TAG_TILEOFFSET];c&&(this.tileoffset.x=parseInt(c[me.TMX_TAG_X]),this.tileoffset.y=parseInt(c[me.TMX_TAG_Y]));var d=a.tileproperties;for(var e in d){var f={};me.TMXUtils.mergeProperties(f,d[e]),this.setTileProperty(parseInt(e)+this.firstgid,f)}var g=me.utils.getBasename(a[me.TMX_TAG_IMAGE]),h=g?me.loader.getImage(g):null;h||console.log("melonJS: '"+g+"' file for tileset '"+this.name+"' not found!");var i=a[me.TMX_TAG_TRANS]||null;this.initFromImage(h,i)},initFromImage:function(a,b){a&&(this.image=a,this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing)),this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing))),this.lastgid=this.firstgid+(this.hTileCount*this.vTileCount-1||0),b!==null&&this.image&&(this.image=me.video.applyRGBFilter(this.image,"transparent",b.toUpperCase()).canvas)},setTileProperty:function(a,b){b.isSolid=b.type?b.type.toLowerCase()===this.type.SOLID:!1,b.isPlatform=b.type?b.type.toLowerCase()===this.type.PLATFORM:!1,b.isLeftSlope=b.type?b.type.toLowerCase()===this.type.L_SLOPE:!1,b.isRightSlope=b.type?b.type.toLowerCase()===this.type.R_SLOPE:!1,b.isBreakable=b.type?b.type.toLowerCase()===this.type.BREAKABLE:!1,b.isLadder=b.type?b.type.toLowerCase()===this.type.LADDER:!1,b.isTopLadder=b.type?b.type.toLowerCase()===this.type.TOPLADDER:!1,b.isSlope=b.isLeftSlope||b.isRightSlope,b.isCollidable=!!b.type,this.TileProperties[a]=b},contains:function(a){return a>=this.firstgid&&a<=this.lastgid},getTileImage:function(a){var b=me.video.createCanvasSurface(this.tilewidth,this.tileheight);return this.drawTile(b,0,0,a),b.canvas},getTileProperties:function(a){return this.TileProperties[a]},isTileCollidable:function(a){return this.TileProperties[a].isCollidable},getTileOffsetX:function(a){return this.tileXOffset[a]==null&&(this.tileXOffset[a]=this.margin+(this.spacing+this.tilewidth)*(a%this.hTileCount)),this.tileXOffset[a]},getTileOffsetY:function(a){return this.tileYOffset[a]==null&&(this.tileYOffset[a]=this.margin+(this.spacing+this.tileheight)*~~(a/this.hTileCount)),this.tileYOffset[a]},drawTile:function(a,b,c,d){if(d.flipped){var e=1,f=0,g=0,h=1,i=b,j=c;b=c=0,a.save(),d.flipAD&&(e=0,f=1,g=1,h=0,j+=this.tileheight-this.tilewidth),d.flipX&&(e=-e,g=-g,i+=d.flipAD?this.tileheight:this.tilewidth),d.flipY&&(f=-f,h=-h,j+=d.flipAD?this.tilewidth:this.tileheight),a.transform(e,f,g,h,i,j)}var k=d.tileId-this.firstgid;a.drawImage(this.image,this.getTileOffsetX(k),this.getTileOffsetY(k),this.tilewidth,this.tileheight,b,c,this.tilewidth,this.tileheight),d.flipped&&a.restore()}}),me.TMXTilesetGroup=Object.extend({init:function(){this.tilesets=[]},add:function(a){this.tilesets.push(a)},getTilesetByIndex:function(a){return this.tilesets[a]},getTilesetByGid:function(a){var b=-1;for(var c=0,d=this.tilesets.length;c<d;c++){if(this.tilesets[c].contains(a))return this.tilesets[c];this.tilesets[c].firstgid==this.tilesets[c].lastgid&&a>=this.tilesets[c].firstgid&&(b=c)}if(b!=-1)return this.tilesets[b];throw"no matching tileset found for gid "+a}})}(window),function(a){me.TMXOrthogonalRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d},canRender:function(a){return a.orientation==="orthogonal"&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){return new me.Vector2d(a/this.tilewidth,b/this.tileheight)},tileToPixelCoords:function(a,b){return new me.Vector2d(a*this.tilewidth,b*this.tileheight)},drawTile:function(a,b,c,d,e){e.drawTile(a,e.tileoffset.x+b*this.tilewidth,e.tileoffset.y+(c+1)*this.tileheight-e.tileheight,d)},drawTileLayer:function(a,b,c,d){var e=this.pixelToTileCoords(c.x+d.pos.x,c.y+d.pos.y).floorSelf(),f=this.pixelToTileCoords(c.x+d.pos.x+d.width+this.tilewidth,c.y+d.pos.y+d.height+this.tileheight).ceilSelf();f.x=f.x>this.cols?this.cols:f.x,f.y=f.y>this.rows?this.rows:f.y;for(var g=e.y;g<f.y;g++)for(var h=e.x;h<f.x;h++){var i=b.layerData[h][g];i&&(b.tileset.contains(i.tileId)||(b.tileset=b.tilesets.getTilesetByGid(i.tileId)),this.drawTile(a,h,g,i,b.tileset))}}}),me.TMXIsometricRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d,this.hTilewidth=c/2,this.hTileheight=d/2,this.originX=this.rows*this.hTilewidth},canRender:function(a){return a.orientation==="isometric"&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){a-=this.originX;var c=b/this.tileheight,d=a/this.tilewidth;return new me.Vector2d(c+d,c-d)},tileToPixelCoords:function(a,b){return new me.Vector2d((a-b)*this.hTilewidth+this.originX,(a+b)*this.hTileheight)},drawTile:function(a,b,c,d,e){e.drawTile(a,(this.cols-1)*e.tilewidth+(b-c)*e.tilewidth>>1,-e.tilewidth+(b+c)*e.tileheight>>2,d)},drawTileLayer:function(a,b,c,d){var e=b.tileset,f=e.tileoffset,g=this.pixelToTileCoords(c.x+d.pos.x-e.tilewidth,c.y+d.pos.y-e.tileheight).floorSelf(),h=this.pixelToTileCoords(c.x+d.pos.x+d.width+e.tilewidth,c.y+d.pos.y+d.height+e.tileheight).ceilSelf(),i=this.tileToPixelCoords(h.x,h.y),j=this.tileToPixelCoords(g.x,g.y);j.x-=this.hTilewidth,j.y+=this.tileheight;var k=j.y-d.pos.y+c.y>this.hTileheight,l=d.pos.x+c.x-j.x<this.hTilewidth;k&&(l?(g.x--,j.x-=this.hTilewidth):(g.y--,j.x+=this.hTilewidth),j.y-=this.hTileheight);var m=k^l,n=g.clone();for(var o=j.y;o-this.tileheight<i.y;o+=this.hTileheight){n.setV(g);for(var p=j.x;p<i.x;p+=this.tilewidth){if(n.x>=0&&n.y>=0&&n.x<this.cols&&n.y<this.rows){var q=b.layerData[n.x][n.y];q&&(e.contains(q.tileId)||(e=b.tileset=b.tilesets.getTilesetByGid(q.tileId),f=e.tileoffset),e.drawTile(a,f.x+p,f.y+o-e.tileheight,q))}n.x++,n.y--}m?(g.y++,j.x-=this.hTilewidth,m=!1):(g.x++,j.x+=this.hTilewidth,m=!0)}}})}(window),function(a,b){me.ColorLayer=me.Renderable.extend({init:function(a,c,d){this.name=a,this.color=me.utils.HexToRGB(c),this.z=d,this.opacity=1,this.floating=!0,this.parent(new me.Vector2d(0,0),b.viewport.width,b.viewport.height)},reset:function(){},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&(this.opacity=a.clamp(0,1))},update:function(){return!1},draw:function(a,b){var c=a.globalAlpha;a.globalAlpha=this.opacity,a.fillStyle=this.color,a.fillRect(b.left,b.top,b.width,b.height),a.globalAlpha=c}}),me.ImageLayer=me.Renderable.extend({ratio:1,init:function(a,c,d,e,f,g){this.name=a,this.image=e?me.loader.getImage(me.utils.getBasename(e)):null;if(!this.image)throw"melonJS: '"+e+"' file for Image Layer '"+this.name+"' not found!";this.imagewidth=this.image.width,this.imageheight=this.image.height,this.z=f,this.ratio=g||1,this.lastpos=b.viewport.pos.clone(),c=c?Math.min(b.viewport.width,c):b.viewport.width,d=d?Math.min(b.viewport.height,d):b.viewport.height,this.parent(new me.Vector2d(0,0),c,d),this.opacity=1,this.floating=!0,this._repeat="repeat",this.repeatX=!0,this.repeatY=!0,Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(a){this._repeat=a;switch(this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}}})},reset:function(){this.image=null,this.lastpos=null,this.viewport=null},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&(this.opacity=a.clamp(0,1))},update:function(){if(this.ratio===0)return!1;var a=b.viewport.pos;return this.lastpos.equals(a)?!1:(this.pos.x+=(a.x-this.lastpos.x)*this.ratio%this.imagewidth,this.pos.x=(this.imagewidth+this.pos.x)%this.imagewidth,this.pos.y+=(a.y-this.lastpos.y)*this.ratio%this.imageheight,this.pos.y=(this.imageheight+this.pos.y)%this.imageheight,this.lastpos.setV(a),!0)},draw:function(a,b){if(this.opacity<1){var c=a.globalAlpha;a.globalAlpha=this.opacity}if(this.ratio===0){var d=Math.min(b.width,this.imagewidth),e=Math.min(b.height,this.imageheight);a.drawImage(this.image,b.left,b.top,d,e,b.left,b.top,d,e)}else{var f=~~this.pos.x,g=~~this.pos.y,h=0,i=0,d=Math.min(this.imagewidth-f,this.width),e=Math.min(this.imageheight-g,this.height);do{do a.drawImage(this.image,f,g,d,e,h,i,d,e),g=0,i+=e,e=Math.min(this.imageheight,this.height-i);while(this.repeatY&&i<this.height);h+=d;if(!this.repeatX||h>=this.width)break;f=0,d=Math.min(this.imagewidth,this.width-h),g=~~this.pos.y,i=0,e=Math.min(this.imageheight-~~this.pos.y,this.height)}while(!0)}this.opacity<1&&(a.globalAlpha=c)}}),me.CollisionTiledLayer=me.Renderable.extend({init:function(a,b){this.parent(new me.Vector2d(0,0),a,b),this.isCollisionMap=!0},reset:function(){},checkCollision:function(a,b){var c=b.x<0?a.left+b.x:a.right+b.x,d=b.y<0?a.top+b.y:a.bottom+b.y,e={x:0,y:0,xprop:{},yprop:{}};if(c<=0||c>=this.width)e.x=b.x;if(d<=0||d>=this.height)e.y=b.y;return e}}),me.TMXLayer=me.Renderable.extend({layerData:null,init:function(a,b,c,d,e){this.tilewidth=a,this.tileheight=b,this.orientation=c,this.z=e,this.tilesets=d,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.parent(new me.Vector2d(0,0),0,0)},initFromXML:function(a){this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME),this.visible=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_VISIBLE,1)==1,this.opacity=me.mapReader.TMXParser.getFloatAttribute(a,me.TMX_TAG_OPACITY,1).clamp(0,1),this.cols=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH),this.rows=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,me.TMXUtils.applyTMXPropertiesFromXML(this,a),this.preRender===undefined&&(this.preRender=me.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(me.COLLISION_LAYER),this.isCollisionMap&&!me.debug.renderCollisionMap&&(this.visible=!1),this.preRender&&(this.layerCanvas=me.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),this.layerSurface.globalAlpha=this.opacity)},initFromJSON:function(a){this.name=a[me.TMX_TAG_NAME],this.visible=a[me.TMX_TAG_VISIBLE],this.opacity=parseFloat(a[me.TMX_TAG_OPACITY]).clamp(0,1),this.cols=parseInt(a[me.TMX_TAG_WIDTH]),this.rows=parseInt(a[me.TMX_TAG_HEIGHT]),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,me.TMXUtils.applyTMXPropertiesFromJSON(this,a),this.preRender===undefined&&(this.preRender=me.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(me.COLLISION_LAYER),this.isCollisionMap&&!me.debug.renderCollisionMap&&(this.visible=!1),this.preRender&&(this.layerCanvas=me.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),this.layerSurface.globalAlpha=this.opacity)},reset:function(){this.preRender&&(this.layerCanvas=null,this.layerSurface=null),this.renderer=null,this.layerData=null,this.tileset=null,this.tilesets=null},setRenderer:function(a){this.renderer=a},initArray:function(a,b){this.layerData=[];for(var c=0;c<a;c++){this.layerData[c]=[];for(var d=0;d<b;d++)this.layerData[c][d]=null}},getTileId:function(a,b){var c=this.getTile(a,b);return c?c.tileId:null},getTile:function(a,b){return this.layerData[~~(a/this.tilewidth)][~~(b/this.tileheight)]},setTile:function(a,b,c){this.layerData[a][b]=new me.Tile(a,b,this.tilewidth,this.tileheight,c)},clearTile:function(a,b){this.layerData[a][b]=null,this.visible&&this.preRender&&this.layerSurface.clearRect(a*this.tilewidth,b*this.tileheight,this.tilewidth,this.tileheight)},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&(this.opacity=a.clamp(0,1),this.preRender&&(this.layerSurface.globalAlpha=this.opacity))},checkCollision:function(a,b){var c=b.x<0?~~(a.left+b.x):Math.ceil(a.right-1+b.x),d=b.y<0?~~(a.top+b.y):Math.ceil(a.bottom-1+b.y),e={x:0,xtile:undefined,xprop:{},y:0,ytile:undefined,yprop:{}};return c>0&&c<this.width?b.x!=0&&(e.xtile=this.getTile(c,Math.ceil(a.bottom-1)),e.xtile&&this.tileset.isTileCollidable(e.xtile.tileId)?(e.x=b.x,e.xprop=this.tileset.getTileProperties(e.xtile.tileId)):(e.xtile=this.getTile(c,~~a.top),e.xtile&&this.tileset.isTileCollidable(e.xtile.tileId)&&(e.x=b.x,e.xprop=this.tileset.getTileProperties(e.xtile.tileId)))):e.x=b.x,e.ytile=this.getTile(b.x<0?~~a.left:Math.ceil(a.right-1),d),e.ytile&&this.tileset.isTileCollidable(e.ytile.tileId)?(e.y=b.y||1,e.yprop=this.tileset.getTileProperties(e.ytile.tileId)):(e.ytile=this.getTile(b.x<0?Math.ceil(a.right-1):~~a.left,d),e.ytile&&this.tileset.isTileCollidable(e.ytile.tileId)&&(e.y=b.y||1,e.yprop=this.tileset.getTileProperties(e.ytile.tileId))),e},update:function(){return!1},draw:function(a,c){var d=b.viewport.pos;if(this.preRender){var e=Math.min(c.width,this.width),f=Math.min(c.height,this.height);a.drawImage(this.layerCanvas,d.x+c.pos.x,d.y+c.pos.y,e,f,d.x+c.pos.x,d.y+c.pos.y,e,f)}else{var g=a.globalAlpha;a.globalAlpha=this.opacity,this.renderer.drawTileLayer(a,this,d,c),a.globalAlpha=g}}})}(window,me.game),function(a){me.TMXTileMap=me.Renderable.extend({init:function(a,b,c){this.levelId=a,this.z=0,this.name=null,this.cols=0,this.rows=0,this.tilewidth=0,this.tileheight=0,this.tilesets=null,this.mapLayers=[],this.objectGroups=[],this.initialized=!1,this.version="",this.orientation="",this.tilesets=null,this.parent(new me.Vector2d(b,c),0,0)},reset:function(){if(this.initialized===!0){for(var a=this.mapLayers.length;a--;)this.mapLayers[a].reset(),this.mapLayers[a]=null;for(var a=this.objectGroups.length;a--;)this.objectGroups[a].reset(),this.objectGroups[a]=null;this.tilesets=null,this.mapLayers.length=0,this.objectGroups.length=0,this.pos.set(0,0),this.initialized=!1}},getObjectGroupByName:function(a){var b=null;a=a.trim().toLowerCase();for(var c=this.objectGroups.length;c--;)if(this.objectGroups[c].name.toLowerCase().contains(a)){b=this.objectGroups[c];break}return b},getObjectGroups:function(){return this.objectGroups},getLayers:function(){return this.mapLayers},getLayerByName:function(a){var b=null;a=a.trim().toLowerCase();for(var c=this.mapLayers.length;c--;)if(this.mapLayers[c].name.toLowerCase().contains(a)){b=this.mapLayers[c];break}return a.toLowerCase().contains(me.COLLISION_LAYER)&&b==null&&(b=new me.CollisionTiledLayer(me.game.currentLevel.width,me.game.currentLevel.height)),b},clearTile:function(a,b){for(var c=this.mapLayers.length;c--;)this.mapLayers[c]instanceof me.TMXLayer&&this.mapLayers[c].clearTile(a,b)}})}(window),function(a){function b(){var a={tmxDoc:null,setData:function(a){this.tmxDoc=a},getFirstElementByTagName:function(a){return this.tmxDoc?this.tmxDoc.getElementsByTagName(a)[0]:null},getAllTagElements:function(){return this.tmxDoc?this.tmxDoc.getElementsByTagName("*"):null},getStringAttribute:function(a,b,c){var d=a.getAttribute(b);return d?d.trim():c},getIntAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?parseInt(d):c},getFloatAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?parseFloat(d):c},getBooleanAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?d=="true":c},free:function(){this.tmxDoc=null}};return a}me.TMXMapReader=Object.extend({XMLReader:null,JSONReader:null,TMXParser:null,readMap:function(a){if(a.initialized)return;me.loader.getTMXFormat(a.levelId)==="xml"?(this.XMLReader===null&&(this.XMLReader=new c),this.TMXParser=this.XMLReader.TMXParser,this.XMLReader.readXMLMap(a,me.loader.getTMX(a.levelId))):(this.JSONReader===null&&(this.JSONReader=new d),this.JSONReader.readJSONMap(a,me.loader.getTMX(a.levelId)));if(a.width<me.game.viewport.width||a.height<me.game.viewport.height){var b=~~((me.game.viewport.width-a.width)/2),e=~~((me.game.viewport.height-a.height)/2);a.pos.add({x:b>0?b:0,y:e>0?e:0})}a.initialized=!0},getNewDefaultRenderer:function(a){switch(a.orientation){case"orthogonal":return new me.TMXOrthogonalRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);case"isometric":return new me.TMXIsometricRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);default:throw"melonJS: "+a.orientation+" type TMX Tile Map not supported!"}},setLayerData:function(a,b,c,d){a.initArray(a.cols,a.rows);switch(c){case null:var b=b.getElementsByTagName(me.TMX_TAG_TILE);break;case"json":break;case me.TMX_TAG_CSV:case me.TMX_TAG_ATTR_BASE64:var e="";for(var f=0,g=b.childNodes.length;f<g;f++)e+=b.childNodes[f].nodeValue;if(c==me.TMX_TAG_CSV)var b=me.utils.decodeCSV(e,a.cols);else{var b=me.utils.decodeBase64AsArray(e,4);d!==null&&(b=me.utils.decompress(b,d))}e=null;break;default:throw"melonJS: TMX Tile Map "+c+" encoding not supported!"}var h=0;for(var i=0;i<a.rows;i++)for(var j=0;j<a.cols;j++){var k=c==null?this.TMXParser.getIntAttribute(b[h++],me.TMX_TAG_GID):b[h++];if(k!==0){var l=new me.Tile(j,i,a.tilewidth,a.tileheight,k);a.layerData[j][i]=l,a.tileset.contains(l.tileId)||(a.tileset=a.tilesets.getTilesetByGid(l.tileId)),a.visible&&a.preRender&&a.renderer.drawTile(a.layerSurface,j,i,l,a.tileset)}}}});var c=me.TMXMapReader.extend({TMXParser:null,init:function(){this.TMXParser||(this.TMXParser=new b)},readXMLMap:function(a,b){if(!b)throw"melonJS:"+a.levelId+" TMX map not found";var c=0;this.TMXParser.setData(b);var d=this.TMXParser.getAllTagElements();for(var e=0;e<d.length;e++)switch(d.item(e).nodeName){case me.TMX_TAG_MAP:var f=d.item(e);a.version=this.TMXParser.getStringAttribute(f,me.TMX_TAG_VERSION),a.orientation=this.TMXParser.getStringAttribute(f,me.TMX_TAG_ORIENTATION),a.cols=this.TMXParser.getIntAttribute(f,me.TMX_TAG_WIDTH),a.rows=this.TMXParser.getIntAttribute(f,me.TMX_TAG_HEIGHT),a.tilewidth=this.TMXParser.getIntAttribute(f,me.TMX_TAG_TILEWIDTH),a.tileheight=this.TMXParser.getIntAttribute(f,me.TMX_TAG_TILEHEIGHT),a.width=a.cols*a.tilewidth,a.height=a.rows*a.tileheight,a.backgroundcolor=this.TMXParser.getStringAttribute(f,me.TMX_BACKGROUND_COLOR),a.z=c++,me.TMXUtils.applyTMXPropertiesFromXML(a,f),a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color,a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",a.background_color,c++)),a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,c++));if(me.game.renderer===null||!me.game.renderer.canRender(a))me.game.renderer=this.getNewDefaultRenderer(a);break;case me.TMX_TAG_TILESET:a.tilesets||(a.tilesets=new me.TMXTilesetGroup),a.tilesets.add(this.readTileset(d.item(e)));break;case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(this.readImageLayer(a,d.item(e),c++));break;case me.TMX_TAG_LAYER:a.mapLayers.push(this.readLayer(a,d.item(e),c++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(this.readObjectGroup(a,d.item(e),c++));break;default:}this.TMXParser.free()},readLayer:function(a,b,c){var d=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,c);d.initFromXML(b);var e=b.getElementsByTagName(me.TMX_TAG_DATA)[0],f=this.TMXParser.getStringAttribute(e,me.TMX_TAG_ENCODING,null),g=this.TMXParser.getStringAttribute(e,me.TMX_TAG_COMPRESSION,null);f==""&&(f=null),g==""&&(g=null);if(!d.isCollisionMap||me.debug.renderCollisionMap)me.game.renderer.canRender(d)?d.setRenderer(me.game.renderer):d.setRenderer(me.mapReader.getNewDefaultRenderer(d));return this.setLayerData(d,e,f,g),e=null,d},readImageLayer:function(a,b,c){var d=this.TMXParser.getStringAttribute(b,me.TMX_TAG_NAME),e=this.TMXParser.getIntAttribute(b,me.TMX_TAG_WIDTH),f=this.TMXParser.getIntAttribute(b,me.TMX_TAG_HEIGHT),g=b.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),h=new me.ImageLayer(d,e*a.tilewidth,f*a.tileheight,g,c);return h.visible=this.TMXParser.getIntAttribute(b,me.TMX_TAG_VISIBLE,1)==1,h.opacity=this.TMXParser.getFloatAttribute(b,me.TMX_TAG_OPACITY,1),me.TMXUtils.applyTMXPropertiesFromXML(h,b),h},readTileset:function(a){var b=new me.TMXTileset;return b.initFromXML(a),b},readObjectGroup:function(a,b,c){var d=this.TMXParser.getStringAttribute(b,me.TMX_TAG_NAME),e=new me.TMXOBjectGroup;return e.initFromXML(d,b,a.tilesets,c),e}}),d=me.TMXMapReader.extend({readJSONMap:function(a,b){if(!b)throw"melonJS:"+a.levelId+" TMX map not found";var c=0,d=this;a.version=b[me.TMX_TAG_VERSION],a.orientation=b[me.TMX_TAG_ORIENTATION],a.cols=parseInt(b[me.TMX_TAG_WIDTH]),a.rows=parseInt(b[me.TMX_TAG_HEIGHT]),a.tilewidth=parseInt(b[me.TMX_TAG_TILEWIDTH]),a.tileheight=parseInt(b[me.TMX_TAG_TILEHEIGHT]),a.width=a.cols*a.tilewidth,a.height=a.rows*a.tileheight,a.backgroundcolor=b[me.TMX_BACKGROUND_COLOR],a.z=c++,me.TMXUtils.applyTMXPropertiesFromJSON(a,b),a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color,a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",a.background_color,c++)),a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,c++));if(me.game.renderer===null||!me.game.renderer.canRender(a))me.game.renderer=this.getNewDefaultRenderer(a);a.tilesets||(a.tilesets=new me.TMXTilesetGroup),b.tilesets.forEach(function(b){a.tilesets.add(d.readTileset(b))}),b.layers.forEach(function(b){switch(b.type){case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(d.readImageLayer(a,b,c++));break;case me.TMX_TAG_TILE_LAYER:a.mapLayers.push(d.readLayer(a,b,c++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(d.readObjectGroup(a,b,c++));break;default:}})},readLayer:function(a,b,c){var d=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,c);return d.initFromJSON(b),d.isCollisionMap||(me.game.renderer.canRender(d)?d.setRenderer(me.game.renderer):d.setRenderer(me.mapReader.getNewDefaultRenderer(d))),this.setLayerData(d,b[me.TMX_TAG_DATA],"json",null),d},readImageLayer:function(a,b,c){var d=b[me.TMX_TAG_NAME],e=parseInt(b[me.TMX_TAG_WIDTH]),f=parseInt(b[me.TMX_TAG_HEIGHT]),g=b[me.TMX_TAG_IMAGE],h=new me.ImageLayer(d,e*a.tilewidth,f*a.tileheight,g,c);return h.visible=b[me.TMX_TAG_VISIBLE],h.opacity=parseFloat(b[me.TMX_TAG_OPACITY]),me.TMXUtils.applyTMXPropertiesFromJSON(h,b),h.ratio=parseFloat(h.ratio),h},readTileset:function(a){var b=new me.TMXTileset;return b.initFromJSON(a),b},readObjectGroup:function(a,b,c){var d=new me.TMXOBjectGroup;return d.initFromJSON(b[me.TMX_TAG_NAME],b,a.tilesets,c),d}})}(window),function(a){me.levelDirector=function(){var a={},b={},c=[],d=0;return a.reset=function(){},a.addLevel=function(a){throw"melonJS: no level loader defined"},a.addTMXLevel=function(a,d){if(b[a]==null)b[a]=new me.TMXTileMap(a,0,0),b[a].name=a,c[c.length]=a;else return!1;return d&&d(),!0},a.loadLevel=function(e){e=e.toString().toLowerCase();if(b[e]===undefined)throw"melonJS: level "+e+" not found";if(b[e]instanceof me.TMXTileMap){var f=me.state.isRunning();return f&&me.state.pause(),me.game.reset(),me.utils.resetGUID(e),b[a.getCurrentLevelId()]&&b[a.getCurrentLevelId()].reset(),me.mapReader.readMap(b[e]),d=c.indexOf(e),me.game.loadTMXLevel(b[e]),f&&me.state.resume(),!0}throw"melonJS: no level loader defined"},a.getCurrentLevelId=function(){return c[d]},a.reloadLevel=function(){return a.loadLevel(a.getCurrentLevelId())},a.nextLevel=function(){return d+1<c.length?a.loadLevel(c[d+1]):!1},a.previousLevel=function(){return d-1<0?!1:a.loadLevel(c[d-1])},a.levelCount=function(){return c.length},a}()}(window),function(){me.Tween=function(a){var b=a,c={},d={},e={},f=1e3,g=0,h=null,i=0,j=me.Tween.Easing.Linear.EaseNone,k=null,l=null,m=null;this.to=function(a,c){c!==undefined&&(f=c);for(var d in a){if(b[d]===null)continue;e[d]=a[d]}return this},this.start=function(){me.game.add(this,999),h=me.timer.getTime()+g,i=0;for(var a in e){if(b[a]===null)continue;c[a]=b[a],d[a]=e[a]-b[a]}return this},this.stop=function(){return me.game.remove(this),this},this.delay=function(a){return g=a,this},me.event.subscribe(me.event.STATE_PAUSE,function(){h&&(i=me.timer.getTime())}),me.event.subscribe(me.event.STATE_RESUME,function(){h&&i&&(h+=me.timer.getTime()-i)}),this.easing=function(a){return j=a,this},this.chain=function(a){return k=a,this},this.onUpdate=function(a){return l=a,this},this.onComplete=function(a){return m=a,this},this.update=function(){var a,e,g,i=me.timer.getTime();if(i<h)return!0;(e=(i-h)/f)>=1&&(e=1),g=j(e);for(a in d)b[a]=c[a]+d[a]*g;return l!==null&&l.call(b,g),e===1?(me.game.remove(this),m!==null&&m.call(b),k!==null&&k.start(),!1):!0}},me.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},me.Tween.Easing.Linear.EaseNone=function(a){return a},me.Tween.Easing.Quadratic.EaseIn=function(a){return a*a},me.Tween.Easing.Quadratic.EaseOut=function(a){return a*(2-a)},me.Tween.Easing.Quadratic.EaseInOut=function(a){return(a*=2)<1?.5*a*a:-0.5*(--a*(a-2)-1)},me.Tween.Easing.Cubic.EaseIn=function(a){return a*a*a},me.Tween.Easing.Cubic.EaseOut=function(a){return--a*a*a+1},me.Tween.Easing.Cubic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},me.Tween.Easing.Quartic.EaseIn=function(a){return a*a*a*a},me.Tween.Easing.Quartic.EaseOut=function(a){return 1- --a*a*a*a},me.Tween.Easing.Quartic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)},me.Tween.Easing.Quintic.EaseIn=function(a){return a*a*a*a*a},me.Tween.Easing.Quintic.EaseOut=function(a){return--a*a*a*a*a+1},me.Tween.Easing.Quintic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},me.Tween.Easing.Sinusoidal.EaseIn=function(a){return 1-Math.cos(a*Math.PI/2)},me.Tween.Easing.Sinusoidal.EaseOut=function(a){return Math.sin(a*Math.PI/2)},me.Tween.Easing.Sinusoidal.EaseInOut=function(a){return.5*(1-Math.cos(Math.PI*a))},me.Tween.Easing.Exponential.EaseIn=function(a){return a===0?0:Math.pow(1024,a-1)},me.Tween.Easing.Exponential.EaseOut=function(a){return a===1?1:1-Math.pow(2,-10*a)},me.Tween.Easing.Exponential.EaseInOut=function(a){return a===0?0:a===1?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)},me.Tween.Easing.Circular.EaseIn=function(a){return 1-Math.sqrt(1-a*a)},me.Tween.Easing.Circular.EaseOut=function(a){return Math.sqrt(1- --a*a)},me.Tween.Easing.Circular.EaseInOut=function(a){return(a*=2)<1?-0.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},me.Tween.Easing.Elastic.EaseIn=function(a){var b,c=.1,d=.4;return a===0?0:a===1?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)))},me.Tween.Easing.Elastic.EaseOut=function(a){var b,c=.1,d=.4;return a===0?0:a===1?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin((a-b)*2*Math.PI/d)+1)},me.Tween.Easing.Elastic.EaseInOut=function(a){var b,c=.1,d=.4;return a===0?0:a===1?1:(!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-0.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)*.5+1)},me.Tween.Easing.Back.EaseIn=function(a){var b=1.70158;return a*a*((b+1)*a-b)},me.Tween.Easing.Back.EaseOut=function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},me.Tween.Easing.Back.EaseInOut=function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)},me.Tween.Easing.Bounce.EaseIn=function(a){return 1-me.Tween.Easing.Bounce.EaseOut(1-a)},me.Tween.Easing.Bounce.EaseOut=function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},me.Tween.Easing.Bounce.EaseInOut=function(a){return a<.5?me.Tween.Easing.Bounce.EaseIn(a*2)*.5:me.Tween.Easing.Bounce.EaseOut(a*2-1)*.5+.5}}(),function(){me.event=function(){var a={},b={};return a.STATE_PAUSE="me.state.onPause",a.STATE_RESUME="me.state.onResume",a.GAME_INIT="me.game.onInit",a.LEVEL_LOADED="me.game.onLevelLoaded",a.LOADER_COMPLETE="me.loader.onload",a.LOADER_PROGRESS="me.loader.onProgress",a.KEYDOWN="me.input.keydown",a.KEYUP="me.input.keyup",a.WINDOW_ONRESIZE="window.onresize",a.publish=function(a,c){var d=b[a],e=d?d.length:0;while(e--)d[e].apply(window,c||[])},a.subscribe=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unsubscribe=function(a,c){var d=b[c?a:a[0]],c=c||a[1],e=d?d.length:0;while(e--)d[e]===c&&d.splice(e,1)},a}()}(),function(){me.plugin=function(){var a={};return a.Base=Object.extend({version:undefined,init:function(){}}),a.patch=function(a,b,c){if(a.prototype!==undefined)var a=a.prototype;if(typeof a[b]=="function"){var d=a[b];a[b]=function(a,b){return function(){var a=this.parent;this.parent=d;var c=b.apply(this,arguments);return this.parent=a,c}}(b,c)}else console.error(b+" is not an existing function")},a.register=function(a,b){me.plugin[b]&&console.error("plugin "+b+" already registered");if(a.prototype.version===undefined)throw"melonJS: Plugin version not defined !";if(me.sys.checkVersion(a.prototype.version)>0)throw"melonJS: Plugin version mismatch, expected: "+a.prototype.version+", got: "+me.version;var c=[];arguments.length>2&&(c=Array.prototype.slice.call(arguments,1)),c[0]=a,me.plugin[b]=new(a.bind.apply(a,c));if(!(me.plugin[b]instanceof me.plugin.Base))throw"melonJS: Plugin should extend the me.plugin.Base Class !"},a}()}()